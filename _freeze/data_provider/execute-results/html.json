{
  "hash": "93678134bce29a6919435d23c844ea00",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"provider_data\"\neditor_options: \n   chunk_output_type: console\n---\n\n::: {.cell}\n\n:::\n\n\n## Provider CMS\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndataset_provider_data <- request('https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items') |>\n  req_perform() |>\n  resp_body_json(simplifyVector = TRUE) |> \n  tibble() |> \n  mutate(\n    bureauCode = delist(bureauCode),\n    keyword = map_chr(keyword, \\(x) paste0(delist(x), collapse = \", \")),\n    programCode = delist(programCode),\n    theme = map_chr(theme, \\(x) paste0(delist(x), collapse = \", \"))) |>\n  unnest_wider(contactPoint, names_sep = \"_\") |>\n  unnest_wider(publisher, names_sep = \"_\")\n\ndataset_provider_data |> purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $accessLevel           c234 public                                        ...\n- $landingPage           c234 https://data.cms.gov/provider-data/dataset/23 ...\n- $bureauCode            c234 009:38                                        ...\n- $issued                c234 2020-03-14                                    ...\n- $@type                 c234 dcat:Dataset                                  ...\n- $modified              c234 2024-12-21                                    ...\n- $released              c234 2024-10-23                                    ...\n- $keyword               c234 Quality, Quality Measures                     ...\n- $contactPoint_@type    c234 vcard:Contact                                 ...\n- $contactPoint_fn       c234 Dialysis Facility Helpdesk                    ...\n- $contactPoint_hasEmail c234 mailto:DialysisData@umich.edu                 ...\n- $contactPoint_hasURL   c234 NA                                            ...\n- $publisher_@type       c234 org:Organization                              ...\n- $publisher_name        c234 Centers for Medicare & Medicaid Services (CMS ...\n- $identifier            c234 23ew-n7w9                                     ...\n- $description           c234 A list of all dialysis facilities registered  ...\n- $title                 c234 Dialysis Facility - Listing by Facility       ...\n- $programCode           c234 009:000                                       ...\n- $distribution          L234 list(structure(list(\"@type\" = \"dcat:Distribut ...\n- $theme                 c234 Dialysis facilities                           ...\n- $archiveExclude        l234 NA                                            ...\n```\n\n\n:::\n\n```{.r .cell-code}\ndistribution_provider_data <- dataset_provider_data |> \n  select(distribution) |> \n  unnest(distribution)\n\ndistribution_provider_data |> purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $@type       c234 dcat:Distribution                                       ...\n- $downloadURL c234 https://data.cms.gov/provider-data/sites/default/files/ ...\n- $mediaType   c234 text/csv                                                ...\n- $title       c234 NA                                                      ...\n```\n\n\n:::\n:::\n\n## National Downloadable File\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmeta_ndf <- \\(fname) {\n  \n  stopifnot(curl::has_internet())\n  \n  x <- request(\n    paste0(\n      \"https://data.cms.gov/\",\n      \"provider-data/api/1/\",\n      \"metastore/schemas/\",\n      \"dataset/items/\",\n      switch(fname, \n             affiliations = \"27ea-46a8\", \n             clinicians   = \"mj5m-pzi6\", \n             stop(\"Invalid argument\")),\n    \"?show-reference-ids=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type     = FALSE,\n         simplifyVector = TRUE)\n  \n  distro <- gelm(gelm(x, \"distribution\"), \"identifier\")\n  \n  y <- request(\n    paste0(\n    \"https://data.cms.gov/\", \n    \"provider-data/api/1/\",\n    \"datastore/query/\", \n    distro, \n    \"?limit=1&offset=100&\",\n    \"count=true&results=true&\", \n    \"schema=true&keys=true&\",\n    \"format=json&rowIds=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type = FALSE,\n         simplifyVector = TRUE)\n  \n  z <- gelm(gelm(gelm(y, \"schema\"), distro), \"fields\")\n  \n  list(\n    title        = gelm(x, \"title\"),\n    description  = gelm(x, \"description\"),\n    identifier   = gelm(gelm(x, \"identifier\"), \"identifier\"),\n    distribution = distro,\n    issued       = gelm(x, \"issued\"), \n    modified     = gelm(x, \"modified\")[[1]], \n    released     = gelm(x, \"released\"),\n    dimensions   = paste0(gelm(gelm(y, \"count\"), is.numeric), \" x \", gelm(gelm(z, \"record_number\"), \"length\")), \n    fields       = names(z),\n    site         = gelm(x, \"landingPage\"),\n    csv          = gelm(gelm(gelm(x, \"distribution\"), \"data\"), \"downloadURL\", m = \"df\"),\n    dictionary   = paste0(\"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"))\n  \n}\n```\n:::\n\n### Examples\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmeta_ndf(\"affiliations\") |> purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $title        c1  Facility Affiliation Data\n- $description  c1  This is the facility affiliations data publicly reporte ...\n- $identifier   c1  27ea-46a8\n- $distribution c1  c0bada3c-9379-5a16-99ec-868e930451d6\n- $issued       c1  2023-08-17\n- $modified     c1  2024-12-02\n- $released     c1  2024-12-12\n- $dimensions   c1  1561449 x 10\n- $fields       c10 record_number npi ind_pac_id provider_last_name provide ...\n- $site         c1  https://data.cms.gov/provider-data/dataset/27ea-46a8\n- $csv          c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n- $dictionary   c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n```\n\n\n:::\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmeta_ndf(\"clinicians\") |> purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $title        c1  National Downloadable File\n- $description  c1  The Doctors and Clinicians national downloadable file i ...\n- $identifier   c1  mj5m-pzi6\n- $distribution c1  21902f69-cf10-57df-b859-94bb4c92e05d\n- $issued       c1  2023-08-17\n- $modified     c1  2024-12-02\n- $released     c1  2024-12-12\n- $dimensions   c1  2595328 x 10\n- $fields       c32 record_number npi ind_pac_id ind_enrl_id provider_last_ ...\n- $site         c1  https://data.cms.gov/provider-data/dataset/mj5m-pzi6\n- $csv          c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n- $dictionary   c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}