{
  "hash": "7110fe660c9f06c9ffdb5dac3e5ed3a1",
  "result": {
    "engine": "knitr",
    "markdown": "---\noutput: html_document\neditor_options: \n  chunk_output_type: console\n---\n# Medicaid {#sec-mcdapi}\n\n\n\n## Links\n\n   * [Medicaid.gov API](https://data.medicaid.gov/about/api)\n   * Limit: `8000L`\n\n## Load Catalog\n\n::: {.cell}\n\n```{.r .cell-code}\njoin_title <- \\(a, b) join(x = a, y = b, on = \"title\", verbose = 0)\n\nmake_join_col <- \\(x, col) {\n  na_if(flatten_column(map(x[[ensym(col)]], \\(x) get_elem(as.list(x), \"data\"))), \"\")\n}\n\ndict_title <- \\(x) {\n  perform_simple(request(x)) |>\n    _[[\"data\"]] |>\n    _[[\"title\"]]\n}\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncatalog_mcd <- function() {\n\n  x <- fload(\"https://data.medicaid.gov/api/1/metastore/schemas/dataset/items?show-reference-ids\")\n    \n  x <- x |>\n    as_tbl() |>\n    mtt(\n      modified    = as_date(modified),\n      issued      = as_date(issued),\n      periodicity = recode_iso8601(accrualPeriodicity),\n      contact     = reduce_contact(x$contactPoint)\n    ) |>\n    slt(\n      title,\n      identifier,\n      description,\n      periodicity,\n      issued,\n      modified,\n      contact,\n      theme,\n      keyword,\n      distribution,\n      temporal,\n      references\n    )\n  \n  d <- rowbind(x$distribution, fill = TRUE)\n  \n  tvec <- vctrs::vec_rep_each(x$title, fnobs(get_elem(x$distribution, \"data\", DF.as.list = TRUE)))\n  \n  groups <- new_df(title = x$title, group = make_join_col(x, theme)) |>\n    sbt(not_na(group) & group != \"Uncategorized\")\n  \n  keys <- new_df(title = x$title, keyword = make_join_col(x, keyword))\n  \n  refs <- new_df(title = x$title,\n                 references = na_if(flatten_column(x$references), \"NA\")) |> \n  sbt(not_na(references) & stri_detect_regex(references, \"^https://www.mathematica.org/\", negate = TRUE)) |> \n  mtt(references = stri_replace_all_fixed(references, \", https://www.mathematica.org/\", \"\"))\n  \n  list(\n    sets = reduce(list(\n      slt(x, -theme, -keyword, -references, -distribution), \n      groups, \n      keys, \n      refs), \n      join_title),\n    download = new_tbl(\n      title = tvec, \n      download = delist(get_elem(d$data, \"downloadURL\"))) |> \n      fcount(title, add = TRUE),\n    dictionary = new_tbl(url = funique(delist(get_elem(d$data, \"describedBy\")))) |> \n      mtt(title = map_chr(url, \\(x) dict_title(x))) |> colorder(title)\n    )\n}\n\nx <- catalog_mcd()\n\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$sets\n# A tibble: 482 × 11\n   title        identifier description periodicity issued     modified   contact\n * <chr>        <chr>      <chr>       <chr>       <date>     <date>     <chr>  \n 1 State Drug … ae4d5347-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 2 State Drug … acbd1537-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 3 State Drug … ec0d4b04-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 4 State Drug … 602e7c79-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 5 State Drug … 17c4bf03-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 6 State Drug … 56adbcf4-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 7 State Drug … b28a22a2-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 8 State Drug … d371b0f4-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n 9 State Drug … c39d3302-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n10 State Drug … 57c03da7-… Drug utili… Decenniall… 2015-06-11 2024-06-11 Medica…\n# ℹ 472 more rows\n# ℹ 4 more variables: temporal <chr>, group <chr>, keyword <chr>,\n#   references <chr>\n\n$download\n# A tibble: 515 × 3\n   title                            download                                   N\n   <chr>                            <chr>                                  <int>\n 1 State Drug Utilization Data 1991 https://download.medicaid.gov/data/St…     1\n 2 State Drug Utilization Data 1992 https://download.medicaid.gov/data/St…     1\n 3 State Drug Utilization Data 1993 https://download.medicaid.gov/data/St…     1\n 4 State Drug Utilization Data 1994 https://download.medicaid.gov/data/St…     1\n 5 State Drug Utilization Data 1995 https://download.medicaid.gov/data/St…     1\n 6 State Drug Utilization Data 1996 https://download.medicaid.gov/data/St…     1\n 7 State Drug Utilization Data 1997 https://download.medicaid.gov/data/St…     1\n 8 State Drug Utilization Data 1998 https://download.medicaid.gov/data/St…     1\n 9 State Drug Utilization Data 1999 https://download.medicaid.gov/data/St…     1\n10 State Drug Utilization Data 2000 https://download.medicaid.gov/data/St…     1\n# ℹ 505 more rows\n\n$dictionary\n# A tibble: 66 × 2\n   title                                                            url         \n * <chr>                                                            <chr>       \n 1 State Drug Utilization Data Data Dictionary                      https://dat…\n 2 NADAC Data Dictionary                                            https://dat…\n 3 NADAC 2021 Data Dictionary                                       https://dat…\n 4 Drug Products Data Dictionary                                    https://dat…\n 5 Monthly Enrollment Data Dictionary updated                       https://dat…\n 6 Drug Manufacturer Contact Info Data Dictionary                   https://dat…\n 7 Medicaid Enrollment - New Adult Group - Data Dictionary-12112024 https://dat…\n 8 Quality Measures 2018 Dictionary                                 https://dat…\n 9 Medicaid CMS-64 FFCRA Increased FMAP Expenditure data dictionary https://dat…\n10 NADAC First Time Rates                                           https://dat…\n# ℹ 56 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmcd_url <- function(uuid) {\n  paste0(\"https://data.medicaid.gov/api/1/datastore/query/\", uuid, \"/0\")\n}\n\nmcd_dims <- function(uuid) {\n\n  x <- uuid |>\n    mcd_url() |>\n    request() |>\n    req_url_query(\n      schema  = \"false\",\n      keys    = \"false\",\n      results = \"true\",\n      count   = \"true\",\n      format  = \"json\",\n      rowIds  = \"false\",\n      limit   = 1,\n      offset  = 0\n    ) |>\n    perform_simple()\n\n  list_tidy(\n    rows   = x$count,\n    fields = x$query$properties,\n    pages  = offset_length(rows, 8000L))\n\n}\n\nidentifier <- sbt(x$sets, title == \"State Drug Utilization Data 2020\") |> _[[\"identifier\"]]\n\nmcd_dims(identifier)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$rows\n[1] 4917338\n\n$fields\n [1] \"utilization_type\"               \"state\"                         \n [3] \"ndc\"                            \"labeler_code\"                  \n [5] \"product_code\"                   \"package_size\"                  \n [7] \"year\"                           \"quarter\"                       \n [9] \"suppression_used\"               \"product_name\"                  \n[11] \"units_reimbursed\"               \"number_of_prescriptions\"       \n[13] \"total_amount_reimbursed\"        \"medicaid_amount_reimbursed\"    \n[15] \"non_medicaid_amount_reimbursed\"\n\n$pages\n[1] 615\n```\n\n\n:::\n\n```{.r .cell-code}\nmcd_url(identifier) |> \n  request() |> \n  req_url_query(\n    limit = 10,\n    offset = 0,\n    count = \"true\",\n    results = \"true\",\n    schema = \"false\",\n    keys = \"true\",\n    format = \"json\",\n    rowIds = \"false\"\n  ) |> \n  perform_simple() |> \n  _[[\"results\"]] |> \n  map_na_if() |> \n  as_tbl() |> \n  purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $utilization_type               c10 FFSU        FFSU        FFSU        F ...\n- $state                          c10 AK          AK          AK          A ...\n- $ndc                            c10 00002143380 00002143480 00002143611 0 ...\n- $labeler_code                   c10 00002       00002       00002       0 ...\n- $product_code                   c10 1433        1434        1436        1 ...\n- $package_size                   c10 80          80          11          1 ...\n- $year                           c10 2020        2020        2020        2 ...\n- $quarter                        c10 4           4           4           4 ...\n- $suppression_used               c10 false       false       false       f ...\n- $product_name                   c10 TRULICITY   TRULICITY   EMGALITY P  T ...\n- $units_reimbursed               c10 312.000     418.000     12.000      2 ...\n- $number_of_prescriptions        c10 138         170         11          1 ...\n- $total_amount_reimbursed        c10 119031.37   158507.73   7065.83     1 ...\n- $medicaid_amount_reimbursed     c10 118119.22   152067.42   7065.83     1 ...\n- $non_medicaid_amount_reimbursed c10 912.15      6440.31     0.00        0 ...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nex <- x$dictionary$url[[1]] |> \n  request() |> \n  perform_simple() |> \n  _[[\"data\"]]\n\n\nnew_tbl(\n  fields = ex$fields$name,\n  description = gsub(\"\\r\\n\", \" \", ex$fields$description)) |> \n  map_na_if()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 15 × 2\n   fields                         description                                   \n   <chr>                          <chr>                                         \n 1 utilization_type               Constant of “FFSU” or “MCOU” - The FFSU Recor…\n 2 state                          State Abbreviation - Two character post offic…\n 3 ndc                            The National Drug Code (NDC) is a numerical c…\n 4 labeler_code                   NDC #1 - First segment of National Drug Code …\n 5 product_code                   NDC #2 - Second segment of National Drug Code \n 6 package_size                   NDC #3 - Third segment of National Drug Code  \n 7 year                           Calendar year covered by data.                \n 8 quarter                        Calendar quarter covered by data. Valid value…\n 9 suppression_used               <NA>                                          \n10 product_name                   Product Name as appears on FDA listing form (…\n11 units_reimbursed               The total number of units (based on Unit Type…\n12 number_of_prescriptions        The number of prescriptions reimbursed (by th…\n13 total_amount_reimbursed        The total amount reimbursed by both Medicaid …\n14 medicaid_amount_reimbursed     The amount reimbursed (by the Medicaid Progra…\n15 non_medicaid_amount_reimbursed The amount reimbursed (by non-Medicaid entiti…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nutils::formatOL(\n  x$dictionary$title\n) |> \n  writeLines()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. State Drug Utilization Data Data Dictionary\n 2. NADAC Data Dictionary\n 3. NADAC 2021 Data Dictionary\n 4. Drug Products Data Dictionary\n 5. Monthly Enrollment Data Dictionary updated\n 6. Drug Manufacturer Contact Info Data Dictionary\n 7. Medicaid Enrollment - New Adult Group - Data Dictionary-12112024\n 8. Quality Measures 2018 Dictionary\n 9. Medicaid CMS-64 FFCRA Increased FMAP Expenditure data dictionary\n10. NADAC First Time Rates\n11. Medicaid CMS-64 FFCRA Increased FMAP Expenditure - Data\n    Dictionary-12112024\n12. Medicaid Financial Management Data - Data Dictionary-12112024\n13. Quality Measures 2014-2015 Data Dictionary\n14. Medicaid Financial Management Data – National Totals - Data\n    Dictionary-12112024\n15. State Contact Information Data Dictionary\n16. AMP Reporting Monthly Data Dictionary\n17. Quality Measures 2016-2017 Data Dictionary\n18. NADAC Comparison Data Dictionary\n19. Federal Upper Limits Data Dictionary\n20. AMP Reporting Quarterly Data Dictionary\n21. Quality Measures 2019-2022 Data Dictionary\n22. Newly Reported Drugs Data Dictionary\n23. Division of Pharmacy Releases Index data dictionary\n24. Blood Disorders Data Dictionary\n25. Exclusively Pediatric Data Dictionary\n26. Clotting Factor Drug Report Data Dictionary\n27. Enrollment PUF (program information by month) Data Dictionary\n28. Enrollment PUF (program information by year) Data Dictionary\n29. Enrollment PUF (benefit package by month) Data Dictionary\n30. Enrollment PUF (benefit package by year) Data Dictionary\n31. Enrollment PUF (dual status information by month) Data Dictionary\n32. Enrollment PUF (dual status information by year) Data Dictionary\n33. Enrollment PUF (major eligibility group information by month) Data\n    Dictionary\n34. Enrollment PUF (major eligibility group information by year) Data\n    Dictionary\n35. Enrollment PUF (managed care information by month) Data Dictionary\n36. Enrollment PUF (managed care information by year) Data Dictionary\n37. Service Use PUF (Behavioral Health Services) Data Dictionary\n38. Service Use PUF (Blood Lead Screening Services) Data Dictionary\n39. Service Use PUF (Health Screening Services) Data Dictionary\n40. Service Use PUF (Contraceptive Care Services) Data Dictionary\n41. Service Use PUF (Telehealth Services) Data Dictionary\n42. Service Use PUF (Vaccinations Provided) Data Dictionary\n43. Number and rate of NAS per 1,000 births in newborns whose\n    deliveries were covered by Medicaid or CHIP, 2017 - 2021\n44. Number and rate of SMM among Medicaid- and CHIP-covered deliveries,\n    2017 - 2021\n45. Beneficiaries who could benefit from integrated care, 2017-2021\n46. Beneficiaries receiving a physical health service among\n    beneficiaries receiving a SUD service by physical health cond,\n    2017-2021\n47. Unwinding: Medicaid and CHIP CAA Reporting Metrics\n48. Unwinding: HealthCare.gov Transitions Marketplace Medicaid\n    Unwinding Report\n49. Unwinding: State-based Marketplace (SBM) Medicaid Unwinding Report\n50. Unwinding: HealthCare.gov Marketplace Medicaid Unwinding Report\n51. Unwinding: Separate CHIP Enrollment by Month and State\n52. Medicaid CMS-64 CAA 2023 Increased FMAP Expenditure Data Collected\n    through MBES/CBES - Data Dictionary-12112024\n53. Unwinding: Medicaid and CHIP Updated Renewal Outcomes\n54. Monthly enrollment PI dataset Data dictionary\n55. MLR Public Data Dictionary\n56. Renewal dataset data dictionary\n57. Current Separate CHIP Enrollment by Month and State Data Dictionary\n58. Race and ethnicity of the national Medicaid and CHIP population\n59. Medicaid enrollees who qualify for benefits based on disability\n60. Primary language spoken by the Medicaid and CHIP population\n61. Rural Medicaid and CHIP enrollees\n62. Section 1915(c) waiver program participants\n63. Medicaid and CHIP enrollees who received a well-child visit\n64. Medicaid and CHIP enrollees who received mental health or SUD\n    services\n65. Prematurity and severe maternal morbidity among Medicaid- and\n    CHIP-covered live births\n66. Medicaid Enterprise System Datatable - Data Dictionary\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nutils::formatOL(\n  x$title\n) |> \n  writeLines()\n```\n:::\n\n",
    "supporting": [
      "api_mcd_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}