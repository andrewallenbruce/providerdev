{
  "hash": "0ea4ceee6606aab832d32bf6cd76366c",
  "result": {
    "engine": "knitr",
    "markdown": "# Geospatial {#sec-demogeo}\n\n\n\n## Load Packages\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(provider)\nlibrary(tidygeocoder)\nlibrary(tigris)\nlibrary(rmapshaper)\nlibrary(sf)\noptions(tigris_use_cache = TRUE)\n```\n:::\n\n## Retrieve Addresses of all RHCs in Georgia\n\n::: {.cell}\n\n```{.r .cell-code}\nrhcs <- provider::providers(state = \"GA\", specialty_code = \"00-17\") |> \n  pull(npi) |> \n  map_dfr(\\(x) provider::nppes(npi = x)) |> \n  select(organization, address:zip) |> \n  mutate(address = paste0(address, \" \", city, \", \", state)) |> \n  distinct()\n\nrhcs_ga <- sbt(rhcs, state != \"FL\")\n\nrhcs_ga\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 84 × 5\n   organization                                  address       city  state zip  \n   <chr>                                         <chr>         <chr> <ord> <chr>\n 1 TMC HARALSON FAMILY HEALTHCARE CENTER         204 ALLEN ME… BREM… GA    3011…\n 2 TMC TALLAPOOSA FAMILY HEALTHCARE CENTER       25 W LYON ST… TALL… GA    3017…\n 3 HIAWASSEE FAMILY PRACTICE P C                 56 HOSPITAL … HIAW… GA    3054…\n 4 TMC WEST CARROLL FAMILY HEALTHCARE CENTER INC 1125 E HIGHW… BOWD… GA    3010…\n 5 BACON COUNTY HEALTH SERVICES, INC             204 E 15TH S… ALMA  GA    3151…\n 6 BOWDON- MT. ZION PRIMARY HEALTH CENTER ,INC.  41 WELLINGTO… WHIT… GA    3018…\n 7 HOSPITAL AUTHORITY OF MITCHELL COUNTY         25 PERRY ST … CAMI… GA    3173…\n 8 THE MEDICAL CENTER OF ELBERTON, LLP           109 COLLEGE … ELBE… GA    3063…\n 9 UNION COUNTY HOSPITAL AUTHORITY               162 HOSPITAL… BLAI… GA    3051…\n10 HOSPITAL AUTHORITY OF MITCHELL COUNTY         259 US HIGHW… CAMI… GA    3173…\n# ℹ 74 more rows\n```\n\n\n:::\n:::\n\n## Geocode with {tidygeocoder}\n\n::: {.cell}\n\n```{.r .cell-code}\ngeo_add <- tidygeocoder::geocode(\n  rhcs_ga,\n  address = address,\n  method = 'mapbox', \n  full_results = TRUE)\n\ngeo_add\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 84 × 24\n   organization     address city  state zip     lat  long id    type  place_type\n   <chr>            <chr>   <chr> <ord> <chr> <dbl> <dbl> <chr> <chr> <list>    \n 1 TMC HARALSON FA… 204 AL… BREM… GA    3011…  33.7 -85.1 addr… Feat… <chr [1]> \n 2 TMC TALLAPOOSA … 25 W L… TALL… GA    3017…  33.7 -85.3 addr… Feat… <chr [1]> \n 3 HIAWASSEE FAMIL… 56 HOS… HIAW… GA    3054… -26.3  28.2 addr… Feat… <chr [1]> \n 4 TMC WEST CARROL… 1125 E… BOWD… GA    3010…  33.6 -85.2 addr… Feat… <chr [1]> \n 5 BACON COUNTY HE… 204 E … ALMA  GA    3151…  31.5 -82.5 addr… Feat… <chr [1]> \n 6 BOWDON- MT. ZIO… 41 WEL… WHIT… GA    3018…  33.5 -84.9 addr… Feat… <chr [1]> \n 7 HOSPITAL AUTHOR… 25 PER… CAMI… GA    3173…  31.2 -84.2 addr… Feat… <chr [1]> \n 8 THE MEDICAL CEN… 109 CO… ELBE… GA    3063…  34.1 -82.9 addr… Feat… <chr [1]> \n 9 UNION COUNTY HO… 162 HO… BLAI… GA    3051…  34.9 -84.0 addr… Feat… <chr [1]> \n10 HOSPITAL AUTHOR… 259 US… CAMI… GA    3173…  31.2 -84.2 addr… Feat… <chr [1]> \n# ℹ 74 more rows\n# ℹ 14 more variables: relevance <dbl>, text <chr>, place_name <chr>,\n#   center <list>, mapbox_address <chr>, context <list>,\n#   properties.accuracy <chr>, properties.mapbox_id <chr>, geometry.type <chr>,\n#   geometry.coordinates <list>, `properties.override:postcode` <chr>,\n#   geometry.interpolated <lgl>, matching_text <chr>, matching_place_name <chr>\n```\n\n\n:::\n\n```{.r .cell-code}\nmapbox <- geo_add |> select(organization:long)\n\nmapbox\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 84 × 7\n   organization                            address city  state zip     lat  long\n   <chr>                                   <chr>   <chr> <ord> <chr> <dbl> <dbl>\n 1 TMC HARALSON FAMILY HEALTHCARE CENTER   204 AL… BREM… GA    3011…  33.7 -85.1\n 2 TMC TALLAPOOSA FAMILY HEALTHCARE CENTER 25 W L… TALL… GA    3017…  33.7 -85.3\n 3 HIAWASSEE FAMILY PRACTICE P C           56 HOS… HIAW… GA    3054… -26.3  28.2\n 4 TMC WEST CARROLL FAMILY HEALTHCARE CEN… 1125 E… BOWD… GA    3010…  33.6 -85.2\n 5 BACON COUNTY HEALTH SERVICES, INC       204 E … ALMA  GA    3151…  31.5 -82.5\n 6 BOWDON- MT. ZION PRIMARY HEALTH CENTER… 41 WEL… WHIT… GA    3018…  33.5 -84.9\n 7 HOSPITAL AUTHORITY OF MITCHELL COUNTY   25 PER… CAMI… GA    3173…  31.2 -84.2\n 8 THE MEDICAL CENTER OF ELBERTON, LLP     109 CO… ELBE… GA    3063…  34.1 -82.9\n 9 UNION COUNTY HOSPITAL AUTHORITY         162 HO… BLAI… GA    3051…  34.9 -84.0\n10 HOSPITAL AUTHORITY OF MITCHELL COUNTY   259 US… CAMI… GA    3173…  31.2 -84.2\n# ℹ 74 more rows\n```\n\n\n:::\n:::\n\n## Retrieve Georgia counties shapefile from {tigris}\n\n::: {.cell}\n\n```{.r .cell-code}\ntig_cnt <- tigris::counties(\n  state = \"GA\",\n  year = 2022,\n  progress_bar = FALSE)\n\ntig_cnt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 159 features and 17 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -85.6 ymin: 30.4 xmax: -80.8 ymax: 35\nGeodetic CRS:  NAD83\nFirst 10 features:\n    STATEFP COUNTYFP COUNTYNS GEOID     NAME        NAMELSAD LSAD CLASSFP MTFCC\n16       13      189 00348794 13189 McDuffie McDuffie County   06      H1 G4020\n53       13      025 00351605 13025 Brantley Brantley County   06      H1 G4020\n54       13      171 00326713 13171    Lamar    Lamar County   06      H1 G4020\n83       13      115 00353665 13115    Floyd    Floyd County   06      H1 G4020\n101      13      273 00352238 13273  Terrell  Terrell County   06      H1 G4020\n102      13      063 01672399 13063  Clayton  Clayton County   06      H1 G4020\n105      13      073 00348865 13073 Columbia Columbia County   06      H1 G4020\n126      13      193 00346957 13193    Macon    Macon County   06      H1 G4020\n146      13      049 00357747 13049 Charlton Charlton County   06      H1 G4020\n147      13      233 00343585 13233     Polk     Polk County   06      H1 G4020\n    CSAFP CBSAFP METDIVFP FUNCSTAT      ALAND   AWATER    INTPTLAT     INTPTLON\n16   <NA>   <NA>     <NA>        A  666591525 23112523 +33.4806126 -082.4795333\n53   <NA>   <NA>     <NA>        A 1147972258 10291563 +31.1973339 -081.9829779\n54   <NA>   <NA>     <NA>        A  475264405  6044329 +33.0744405 -084.1466893\n83   <NA>   <NA>     <NA>        A 1320431515 22387093 +34.2636901 -085.2136849\n101  <NA>   <NA>     <NA>        A  869695791  4951325 +31.7771909 -084.4394464\n102  <NA>   <NA>     <NA>        A  367145192  6928044 +33.5516027 -084.4128678\n105  <NA>   <NA>     <NA>        A  751598754 45345677 +33.5520746 -082.2496077\n126  <NA>   <NA>     <NA>        A 1037709945 13841916 +32.3626859 -084.0512306\n146  <NA>   <NA>     <NA>        A 2020415648  5963237 +30.7799036 -082.1396442\n147  <NA>   <NA>     <NA>        A  803775591  4664760 +33.9960153 -085.1883384\n                          geometry\n16  MULTIPOLYGON (((-82.6 33.6,...\n53  MULTIPOLYGON (((-81.9 31.1,...\n54  MULTIPOLYGON (((-84.2 33.1,...\n83  MULTIPOLYGON (((-85 34.3, -...\n101 MULTIPOLYGON (((-84.3 31.7,...\n102 MULTIPOLYGON (((-84.5 33.6,...\n105 MULTIPOLYGON (((-82.4 33.6,...\n126 MULTIPOLYGON (((-83.8 32.4,...\n146 MULTIPOLYGON (((-82.4 30.8,...\n147 MULTIPOLYGON (((-85.2 33.9,...\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_cnt <- ms_simplify(tig_cnt)\n\nsf_cnt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 159 features and 17 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: -85.6 ymin: 30.4 xmax: -80.8 ymax: 35\nGeodetic CRS:  NAD83\nFirst 10 features:\n   FUNCSTAT GEOID COUNTYFP    INTPTLAT CBSAFP CSAFP COUNTYNS CLASSFP METDIVFP\n1         A 13189      189 +33.4806126   <NA>  <NA> 00348794      H1     <NA>\n2         A 13025      025 +31.1973339   <NA>  <NA> 00351605      H1     <NA>\n3         A 13171      171 +33.0744405   <NA>  <NA> 00326713      H1     <NA>\n4         A 13115      115 +34.2636901   <NA>  <NA> 00353665      H1     <NA>\n5         A 13273      273 +31.7771909   <NA>  <NA> 00352238      H1     <NA>\n6         A 13063      063 +33.5516027   <NA>  <NA> 01672399      H1     <NA>\n7         A 13073      073 +33.5520746   <NA>  <NA> 00348865      H1     <NA>\n8         A 13193      193 +32.3626859   <NA>  <NA> 00346957      H1     <NA>\n9         A 13049      049 +30.7799036   <NA>  <NA> 00357747      H1     <NA>\n10        A 13233      233 +33.9960153   <NA>  <NA> 00343585      H1     <NA>\n       NAME        NAMELSAD LSAD MTFCC STATEFP      ALAND   AWATER     INTPTLON\n1  McDuffie McDuffie County   06 G4020      13  666591525 23112523 -082.4795333\n2  Brantley Brantley County   06 G4020      13 1147972258 10291563 -081.9829779\n3     Lamar    Lamar County   06 G4020      13  475264405  6044329 -084.1466893\n4     Floyd    Floyd County   06 G4020      13 1320431515 22387093 -085.2136849\n5   Terrell  Terrell County   06 G4020      13  869695791  4951325 -084.4394464\n6   Clayton  Clayton County   06 G4020      13  367145192  6928044 -084.4128678\n7  Columbia Columbia County   06 G4020      13  751598754 45345677 -082.2496077\n8     Macon    Macon County   06 G4020      13 1037709945 13841916 -084.0512306\n9  Charlton Charlton County   06 G4020      13 2020415648  5963237 -082.1396442\n10     Polk     Polk County   06 G4020      13  803775591  4664760 -085.1883384\n                         geometry\n1  POLYGON ((-82.6 33.6, -82.6...\n2  POLYGON ((-81.9 31, -81.9 3...\n3  POLYGON ((-84.2 33.2, -84.2...\n4  POLYGON ((-85 34.1, -85 34....\n5  POLYGON ((-84.3 31.7, -84.3...\n6  POLYGON ((-84.4 33.6, -84.4...\n7  POLYGON ((-82.4 33.7, -82.4...\n8  MULTIPOLYGON (((-83.8 32.3,...\n9  POLYGON ((-82.1 31, -82.2 3...\n10 POLYGON ((-85.4 33.9, -85.3...\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_cnt$mid <- st_centroid(sf_cnt$geometry)\n\nsf_cnt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 159 features and 17 fields\nActive geometry column: geometry\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: -85.6 ymin: 30.4 xmax: -80.8 ymax: 35\nGeodetic CRS:  NAD83\nFirst 10 features:\n   FUNCSTAT GEOID COUNTYFP    INTPTLAT CBSAFP CSAFP COUNTYNS CLASSFP METDIVFP\n1         A 13189      189 +33.4806126   <NA>  <NA> 00348794      H1     <NA>\n2         A 13025      025 +31.1973339   <NA>  <NA> 00351605      H1     <NA>\n3         A 13171      171 +33.0744405   <NA>  <NA> 00326713      H1     <NA>\n4         A 13115      115 +34.2636901   <NA>  <NA> 00353665      H1     <NA>\n5         A 13273      273 +31.7771909   <NA>  <NA> 00352238      H1     <NA>\n6         A 13063      063 +33.5516027   <NA>  <NA> 01672399      H1     <NA>\n7         A 13073      073 +33.5520746   <NA>  <NA> 00348865      H1     <NA>\n8         A 13193      193 +32.3626859   <NA>  <NA> 00346957      H1     <NA>\n9         A 13049      049 +30.7799036   <NA>  <NA> 00357747      H1     <NA>\n10        A 13233      233 +33.9960153   <NA>  <NA> 00343585      H1     <NA>\n       NAME        NAMELSAD LSAD MTFCC STATEFP      ALAND   AWATER     INTPTLON\n1  McDuffie McDuffie County   06 G4020      13  666591525 23112523 -082.4795333\n2  Brantley Brantley County   06 G4020      13 1147972258 10291563 -081.9829779\n3     Lamar    Lamar County   06 G4020      13  475264405  6044329 -084.1466893\n4     Floyd    Floyd County   06 G4020      13 1320431515 22387093 -085.2136849\n5   Terrell  Terrell County   06 G4020      13  869695791  4951325 -084.4394464\n6   Clayton  Clayton County   06 G4020      13  367145192  6928044 -084.4128678\n7  Columbia Columbia County   06 G4020      13  751598754 45345677 -082.2496077\n8     Macon    Macon County   06 G4020      13 1037709945 13841916 -084.0512306\n9  Charlton Charlton County   06 G4020      13 2020415648  5963237 -082.1396442\n10     Polk     Polk County   06 G4020      13  803775591  4664760 -085.1883384\n                         geometry                mid\n1  POLYGON ((-82.6 33.6, -82.6... POINT (-82.5 33.5)\n2  POLYGON ((-81.9 31, -81.9 3...   POINT (-82 31.2)\n3  POLYGON ((-84.2 33.2, -84.2... POINT (-84.1 33.1)\n4  POLYGON ((-85 34.1, -85 34.... POINT (-85.2 34.3)\n5  POLYGON ((-84.3 31.7, -84.3... POINT (-84.4 31.8)\n6  POLYGON ((-84.4 33.6, -84.4... POINT (-84.4 33.5)\n7  POLYGON ((-82.4 33.7, -82.4... POINT (-82.3 33.5)\n8  MULTIPOLYGON (((-83.8 32.3,...   POINT (-84 32.4)\n9  POLYGON ((-82.1 31, -82.2 3... POINT (-82.1 30.8)\n10 POLYGON ((-85.4 33.9, -85.3...   POINT (-85.2 34)\n```\n\n\n:::\n:::\n\n## Map with {ggplot}\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sf_cnt) +\n  geom_sf(\n    fill = \"skyblue\",\n    colour = \"white\",\n    alpha = 0.5) +\n  geom_sf_text(\n    aes(geometry = geometry, \n        label = NAME),\n    size = 3.5,\n    check_overlap = TRUE) +\n  geom_jitter(\n    data = sbt(mapbox, city != \"HIAWASSEE\"),\n    mapping = aes(long, lat),\n    fill = \"yellow\",\n    color = \"darkred\",\n    alpha = 0.75,\n    size = 4,\n    shape = 21,\n    stroke = 1)\n```\n\n::: {.cell-output-display}\n![](demo_geo_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "demo_geo_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}