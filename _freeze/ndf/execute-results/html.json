{
  "hash": "497f406d12844f0e54695321e7a1ac75",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"NDF\"\neditor_options: \n   chunk_output_type: console\n---\n\n::: {.cell}\n\n:::\n\n## National Downloadable File\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhttr2::url_parse(\"https://data.cms.gov/provider-data/api/1/datastore/query/\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n<httr2_url> https://data.cms.gov/provider-data/api/1/datastore/query/\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• scheme: https\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• hostname: data.cms.gov\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• path: /provider-data/api/1/datastore/query/\n```\n\n\n:::\n\n```{.r .cell-code}\n# distro \n\nunclass(\n  httr2::url_parse(\n    \"?limit=1&offset=100&count=true&results=true&schema=true&keys=true&format=json&rowIds=true\"\n    )\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$scheme\nNULL\n\n$hostname\nNULL\n\n$username\nNULL\n\n$password\nNULL\n\n$port\nNULL\n\n$path\nNULL\n\n$query\n$query$limit\n[1] \"1\"\n\n$query$offset\n[1] \"100\"\n\n$query$count\n[1] \"true\"\n\n$query$results\n[1] \"true\"\n\n$query$schema\n[1] \"true\"\n\n$query$keys\n[1] \"true\"\n\n$query$format\n[1] \"json\"\n\n$query$rowIds\n[1] \"true\"\n\n\n$fragment\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\nndf_identifier <- \\(x) {\n  kit::nswitch(x,\n    \"affiliations\", \"27ea-46a8\",\n    \"clinicians\", \"mj5m-pzi6\",\n    default = NA_character_,\n    nThread = 4L)\n}\n\nurl_ndf <- httr2::url_parse(\n  \"https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/\"\n  )\n\nurl_tmp <- url_ndf |> \n  httr2::url_build() |> \n  httr2::request()\n\nhttr2::req_template(\n  url_tmp, \n  \"/{fname}?show-reference-ids=true\", \n  fname = ndf_identifier(\"affiliations\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n<httr2_request>\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGET\nhttps://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/27ea-46a8?show-reference-ids=true\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nBody: empty\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n## Function Draft\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmeta_ndf <- \\(fname) {\n  \n  stopifnot(curl::has_internet())\n  \n  x <- request(\n    paste0(\n      \"https://data.cms.gov/\",\n      \"provider-data/api/1/\",\n      \"metastore/schemas/\",\n      \"dataset/items/\",\n      switch(fname, \n             affiliations = \"27ea-46a8\", \n             clinicians   = \"mj5m-pzi6\", \n             stop(\"Invalid argument\")),\n    \"?show-reference-ids=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type     = FALSE,\n         simplifyVector = TRUE)\n  \n  distro <- gelm(gelm(x, \"distribution\"), \"identifier\")\n  \n  y <- request(\n    paste0(\n    \"https://data.cms.gov/\", \n    \"provider-data/api/1/\",\n    \"datastore/query/\", \n    distro, \n    \"?limit=1&offset=100&\",\n    \"count=true&results=true&\", \n    \"schema=true&keys=true&\",\n    \"format=json&rowIds=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type = FALSE,\n         simplifyVector = TRUE)\n  \n  z <- gelm(gelm(gelm(y, \"schema\"), distro), \"fields\")\n  \n  list(\n    title        = gelm(x, \"title\"),\n    description  = gelm(x, \"description\"),\n    identifier   = gelm(gelm(x, \"identifier\"), \"identifier\"),\n    distribution = distro,\n    issued       = gelm(x, \"issued\"), \n    modified     = gelm(x, \"modified\")[[1]], \n    released     = gelm(x, \"released\"),\n    dimensions   = paste0(gelm(gelm(y, \"count\"), is.numeric), \" x \", gelm(gelm(z, \"record_number\"), \"length\")), \n    fields       = names(z),\n    site         = gelm(x, \"landingPage\"),\n    csv          = gelm(gelm(gelm(x, \"distribution\"), \"data\"), \"downloadURL\", m = \"df\"),\n    dictionary   = paste0(\"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"))\n  \n}\n```\n:::\n\n### Field Comparison\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm_aff <- meta_ndf(\"affiliations\")\n\nm_aff\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"Facility Affiliation Data\"\n\n$description\n[1] \"This is the facility affiliations data publicly reported in the Provider Data Catalog.\"\n\n$identifier\n[1] \"27ea-46a8\"\n\n$distribution\n[1] \"c0bada3c-9379-5a16-99ec-868e930451d6\"\n\n$issued\n[1] \"2023-08-17\"\n\n$modified\n[1] \"2024-12-02\"\n\n$released\n[1] \"2024-12-12\"\n\n$dimensions\n[1] \"1561449 x 10\"\n\n$fields\n [1] \"record_number\"                             \n [2] \"npi\"                                       \n [3] \"ind_pac_id\"                                \n [4] \"provider_last_name\"                        \n [5] \"provider_first_name\"                       \n [6] \"provider_middle_name\"                      \n [7] \"suff\"                                      \n [8] \"facility_type\"                             \n [9] \"facility_affiliations_certification_number\"\n[10] \"facility_type_certification_number\"        \n\n$site\n[1] \"https://data.cms.gov/provider-data/dataset/27ea-46a8\"\n\n$csv\n[1] \"https://data.cms.gov/provider-data/sites/default/files/resources/b7c4080ae144663e43353a9c35cd3f53_1733184311/Facility_Affiliation.csv\"\n\n$dictionary\n[1] \"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"\n```\n\n\n:::\n\n```{.r .cell-code}\nm_clin <- meta_ndf(\"clinicians\")\n\nm_clin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"National Downloadable File\"\n\n$description\n[1] \"The Doctors and Clinicians national downloadable file is organized such that each line is unique at the clinician/enrollment record/group/address level. Clinicians with multiple Medicare enrollment records and/or single enrollments linking to multiple practice locations are listed on multiple lines.\"\n\n$identifier\n[1] \"mj5m-pzi6\"\n\n$distribution\n[1] \"21902f69-cf10-57df-b859-94bb4c92e05d\"\n\n$issued\n[1] \"2023-08-17\"\n\n$modified\n[1] \"2024-12-02\"\n\n$released\n[1] \"2024-12-12\"\n\n$dimensions\n[1] \"2595328 x 10\"\n\n$fields\n [1] \"record_number\"        \"npi\"                  \"ind_pac_id\"          \n [4] \"ind_enrl_id\"          \"provider_last_name\"   \"provider_first_name\" \n [7] \"provider_middle_name\" \"suff\"                 \"gndr\"                \n[10] \"cred\"                 \"med_sch\"              \"grd_yr\"              \n[13] \"pri_spec\"             \"sec_spec_1\"           \"sec_spec_2\"          \n[16] \"sec_spec_3\"           \"sec_spec_4\"           \"sec_spec_all\"        \n[19] \"telehlth\"             \"facility_name\"        \"org_pac_id\"          \n[22] \"num_org_mem\"          \"adr_ln_1\"             \"adr_ln_2\"            \n[25] \"ln_2_sprs\"            \"citytown\"             \"state\"               \n[28] \"zip_code\"             \"telephone_number\"     \"ind_assgn\"           \n[31] \"grp_assgn\"            \"adrs_id\"             \n\n$site\n[1] \"https://data.cms.gov/provider-data/dataset/mj5m-pzi6\"\n\n$csv\n[1] \"https://data.cms.gov/provider-data/sites/default/files/resources/52c3f098d7e56028a298fd297cb0b38d_1733184310/DAC_NationalDownloadableFile.csv\"\n\n$dictionary\n[1] \"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"\n```\n\n\n:::\n:::\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\naff <- provider::affiliations(\n  npi = 1558595660, \n  na.rm = FALSE, \n  tidy = FALSE)\n\ncat(\n  utils::formatOL(\n    m_aff$fields), \n  sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. provider_last_name\n 5. provider_first_name\n 6. provider_middle_name\n 7. suff\n 8. facility_type\n 9. facility_affiliations_certification_number\n10. facility_type_certification_number\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\n  utils::formatOL(\n    names(aff)), \n  sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. provider_last_name\n 5. provider_first_name\n 6. provider_middle_name\n 7. suff\n 8. facility_type\n 9. facility_affiliations_certification_number\n10. facility_type_certification_number\n```\n\n\n:::\n:::\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\ncln <- provider::clinicians(\n  npi = 1558595660, \n  na.rm = FALSE, \n  tidy = FALSE)\n\ncat(\n  utils::formatOL(\n    m_clin$fields), \n  sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. ind_enrl_id\n 5. provider_last_name\n 6. provider_first_name\n 7. provider_middle_name\n 8. suff\n 9. gndr\n10. cred\n11. med_sch\n12. grd_yr\n13. pri_spec\n14. sec_spec_1\n15. sec_spec_2\n16. sec_spec_3\n17. sec_spec_4\n18. sec_spec_all\n19. telehlth\n20. facility_name\n21. org_pac_id\n22. num_org_mem\n23. adr_ln_1\n24. adr_ln_2\n25. ln_2_sprs\n26. citytown\n27. state\n28. zip_code\n29. telephone_number\n30. ind_assgn\n31. grp_assgn\n32. adrs_id\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\n  utils::formatOL(\n    names(cln)), \n  sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. ind_enrl_id\n 5. provider_last_name\n 6. provider_first_name\n 7. provider_middle_name\n 8. suff\n 9. gndr\n10. cred\n11. med_sch\n12. grd_yr\n13. pri_spec\n14. sec_spec_1\n15. sec_spec_2\n16. sec_spec_3\n17. sec_spec_4\n18. sec_spec_all\n19. telehlth\n20. facility_name\n21. org_pac_id\n22. num_org_mem\n23. adr_ln_1\n24. adr_ln_2\n25. ln_2_sprs\n26. citytown\n27. state\n28. zip_code\n29. telephone_number\n30. ind_assgn\n31. grp_assgn\n32. adrs_id\n```\n\n\n:::\n:::\n",
    "supporting": [
      "ndf_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}