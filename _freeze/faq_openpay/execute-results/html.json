{
  "hash": "539587518c2167baf21a60ff46e4c576",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Open Payments API\"\neditor_options: \n   chunk_output_type: console\n---\n\n\n## Dataset\n\n   * `publisher`: `\"openpaymentsdata.cms.gov\"`\n   * `bureauCode`: `\"009:38\"`\n   * `programCode`: `\"009:000\"`\n   * `accessLevel`: `\"public\"`\n   * limit = `500`\n\n::: {.cell}\n\n```{.r .cell-code}\nget_describedby <- \\(x) {\n  \n  x <- map(get_elem(\n    get_elem(x$distribution, \"data\", DF.as.list = TRUE),\n    \"title|describedBy\",\n    regex = TRUE\n  ), function(x)\n    x[not_null(names(x))])\n  \n  new_df(\n    title = delist(get_elem(x, \"title\")), \n    describedBy = delist(get_elem(x, \"describedBy\")))\n}\n\nadd_downloadurl <- \\(x) {\n  add_vars(x, downloadURL = delist(get_elem(\n    get_elem(x$distribution, \"data\", DF.as.list = TRUE),\n    \"downloadURL\"\n  )))\n}\n\nload_open <- \\() {\n  \n  dataset <- as_tbl(\n  mtt(\n    fload(\"https://openpaymentsdata.cms.gov/api/1/metastore/schemas/dataset/items?show-reference-ids\"), \n    modified    = as_date(modified), \n    description = replace_fixed(description, c(\"\\n\", \"\\r. \\r.\"), c(\". \", \"\")),\n    theme       = delist(map(theme, function(x) get_elem(as.list(x), \"data\"))), \n    year        = delist(map(keyword, function(x) get_elem(as.list(x), \"data\"))), \n    year        = replace_fixed(year, c(\"all years\"), c(\"All\")),\n    identifier  = paste0(\"https://openpaymentsdata.cms.gov/api/1/datastore/query/\", identifier, \"/0\")))\n  \n  dataset <- roworder(\n    slt(\n      join(\n        add_downloadurl(dataset),\n        get_describedby(dataset) |>\n          mtt(\n            year = stri_extract_all_regex(title, \"[0-9]{4}\"),\n            name = stri_extract_all_regex(title, \"^.*(?=\\\\s.\\\\sDetailed Dataset [0-9]{4} Reporting Year)\"),\n            title = ifelse(na(name), title, glue(\"{year} {name}\")),\n            year = NULL,\n            name = NULL\n          ),\n        on = \"title\",\n        verbose = 0\n      ),\n      year,\n      theme,\n      title,\n      description,\n      modified,\n      temporal,\n      identifier,\n      downloadURL,\n      describedBy\n    ),\n    -theme,\n    -year,\n    title\n  )\n  \n  dataset <- rsplit(dataset, ~ theme)\n  \n  list(\n    SummaryAll  = sbt(dataset$Summary, year == \"All\", -year),\n    SummaryYear = sbt(dataset$Summary, year != \"All\", -describedBy) |> mtt(year = as_int(year)),\n    General     = mtt(dataset$`General Payments`, year = as_int(year)),\n    Research    = mtt(dataset$`Research Payments`, year = as_int(year)),\n    Ownership   = mtt(dataset$`Ownership Payments`, year = as_int(year)))\n  \n}\n\ndataset <- load_open()\n\ndataset\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$SummaryAll\n# A tibble: 17 × 7\n   title      description modified   temporal identifier downloadURL describedBy\n   <chr>      <chr>       <date>     <chr>    <chr>      <chr>       <chr>      \n 1 Covered R… The Covere… 2025-01-30 2017-01… https://o… https://do… https://op…\n 2 National … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 3 National … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 4 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 5 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 6 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 7 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 8 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n 9 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n10 Payments … This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n11 Physician… This datas… 2025-01-30 <NA>     https://o… https://do… <NA>       \n12 Profile I… This datas… 2025-01-30 <NA>     https://o… https://do… <NA>       \n13 Reporting… This datas… 2025-01-30 <NA>     https://o… https://do… <NA>       \n14 State lev… This datas… 2025-01-30 2017-01… https://o… https://do… <NA>       \n15 State pay… Groups pay… 2025-01-30 2022-01… https://o… https://do… <NA>       \n16 Summary D… Summary da… 2025-01-30 2017-01… https://o… https://do… <NA>       \n17 Teaching … This datas… 2025-01-30 <NA>     https://o… https://do… <NA>       \n\n$SummaryYear\n# A tibble: 36 × 7\n    year title            description modified   temporal identifier downloadURL\n   <int> <chr>            <chr>       <date>     <chr>    <chr>      <chr>      \n 1  2023 2023 payments g… This datas… 2025-01-30 2023-01… https://o… https://do…\n 2  2023 2023 payments g… This datas… 2025-01-30 2023-01… https://o… https://do…\n 3  2023 2023 payments g… This datas… 2025-01-30 2023-01… https://o… https://do…\n 4  2023 2023 payments g… This datas… 2025-01-30 2023-01… https://o… https://do…\n 5  2023 2023 state paym… Groups pay… 2025-01-30 2023-01… https://o… https://do…\n 6  2022 2022 payments g… This datas… 2025-01-30 2022-01… https://o… https://do…\n 7  2022 2022 payments g… This datas… 2025-01-30 2022-01… https://o… https://do…\n 8  2022 2022 payments g… This datas… 2025-01-30 2022-01… https://o… https://do…\n 9  2022 2022 payments g… This datas… 2025-01-30 2022-01… https://o… https://do…\n10  2022 2022 state paym… Groups pay… 2025-01-30 2022-01… https://o… https://do…\n# ℹ 26 more rows\n\n$General\n# A tibble: 7 × 8\n   year title description modified   temporal identifier downloadURL describedBy\n  <int> <chr> <chr>       <date>     <chr>    <chr>      <chr>       <chr>      \n1  2023 2023… \"All gener… 2025-01-30 2023-01… https://o… https://do… https://op…\n2  2022 2022… \"All gener… 2025-01-30 2022-01… https://o… https://do… https://op…\n3  2021 2021… \"All gener… 2025-01-30 2021-01… https://o… https://do… https://op…\n4  2020 2020… \"All gener… 2025-01-30 2020-01… https://o… https://do… https://op…\n5  2019 2019… \"All gener… 2025-01-30 2019-01… https://o… https://do… https://op…\n6  2018 2018… \"All gener… 2025-01-30 2018-01… https://o… https://do… https://op…\n7  2017 2017… \"All gener… 2025-01-30 2017-01… https://o… https://do… https://op…\n\n$Research\n# A tibble: 7 × 8\n   year title description modified   temporal identifier downloadURL describedBy\n  <int> <chr> <chr>       <date>     <chr>    <chr>      <chr>       <chr>      \n1  2023 2023… Research P… 2025-01-30 2023-01… https://o… https://do… https://op…\n2  2022 2022… Research P… 2025-01-30 2022-01… https://o… https://do… https://op…\n3  2021 2021… Research P… 2025-01-30 2021-01… https://o… https://do… https://op…\n4  2020 2020… Research P… 2025-01-30 2020-01… https://o… https://do… https://op…\n5  2019 2019… Research P… 2025-01-30 2019-01… https://o… https://do… https://op…\n6  2018 2018… Research P… 2025-01-30 2018-01… https://o… https://do… https://op…\n7  2017 2017… Research P… 2025-01-30 2017-01… https://o… https://do… https://op…\n\n$Ownership\n# A tibble: 7 × 8\n   year title description modified   temporal identifier downloadURL describedBy\n  <int> <chr> <chr>       <date>     <chr>    <chr>      <chr>       <chr>      \n1  2023 2023… Ownership … 2025-01-30 2023-01… https://o… https://do… https://op…\n2  2022 2022… Ownership … 2025-01-30 2022-01… https://o… https://do… https://op…\n3  2021 2021… Ownership … 2025-01-30 2021-01… https://o… https://do… https://op…\n4  2020 2020… Ownership … 2025-01-30 2020-01… https://o… https://do… https://op…\n5  2019 2019… Ownership … 2025-01-30 2019-01… https://o… https://do… https://op…\n6  2018 2018… Ownership … 2025-01-30 2018-01… https://o… https://do… https://op…\n7  2017 2017… Ownership … 2025-01-30 2017-01… https://o… https://do… https://op…\n```\n\n\n:::\n:::\n\n## Dictionaries\n\n::: {.cell}\n\n```{.r .cell-code}\nget_dictionary <- function(x) {\n  \n  x <- x |> \n    _[[\"describedBy\"]] |> \n    request() |> \n    req_perform() |> \n    resp_simple_json() |> \n    as_tbl() |> \n    _[[\"data\"]]\n  \n  list(\n    title         = x$title,\n    dictionary    = new_tbl(\n      field       = delist(get_elem(x$fields, \"name\")),\n      description = delist(get_elem(x$fields, \"description\")))\n  )\n}\n```\n:::\n\n### Covered Recipient Profile Supplement\n\n::: {.cell}\n\n```{.r .cell-code}\ndict_covered_recipient <- dataset$SummaryAll |> \n  sbt(not_na(describedBy)) |> \n  get_dictionary()\n\ndict_covered_recipient\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"Covered Recipient Profile Supplement File Attributes\"\n\n$dictionary\n# A tibble: 32 × 2\n   field                                          description                   \n   <chr>                                          <chr>                         \n 1 covered_recipient_profile_type                 \"Indicator showing if recipie…\n 2 covered_recipient_profile_id                   \"System generated unique iden…\n 3 associated_covered_recipient_profile_id_1      \"Covered_Recipient_Profile_ID…\n 4 associated_covered_recipient_profile_id_2      \"Covered_Recipient_Profile_ID…\n 5 covered_recipient_npi                          \"National Provider Identifier…\n 6 covered_recipient_profile_first_name           \"The first name as available …\n 7 covered_recipient_profile_middle_name          \"The middle name as available…\n 8 covered_recipient_profile_last_name            \"The last name as available i…\n 9 covered_recipient_profile_suffix               \"The suffix as available in t…\n10 covered_recipient_profile_alternate_first_name \"The alternate first name as …\n# ℹ 22 more rows\n```\n\n\n:::\n:::\n\n### General Payment File\n\n::: {.cell}\n\n```{.r .cell-code}\ndict_general <- dataset$General |> \n  sbt(year == \"2023\") |> \n  get_dictionary()\n\ndict_general\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"General Payment File Attributes\"\n\n$dictionary\n# A tibble: 91 × 2\n   field                         description                                    \n   <chr>                         <chr>                                          \n 1 change_type                   \"An indicator showing if the payment record is…\n 2 covered_recipient_type        \"An indicator showing if the recipient of the …\n 3 teaching_hospital_ccn         \"A unique identifying number (CMS Certificatio…\n 4 teaching_hospital_id          \"The system generated a unique identifier of t…\n 5 teaching_hospital_name        \"The name of the Teaching Hospital receiving t…\n 6 covered_recipient_profile_id  \"System generated unique identifier for covere…\n 7 covered_recipient_npi         \"National Provider Identifier is a unique iden…\n 8 covered_recipient_first_name  \"First name of the covered recipient physician…\n 9 covered_recipient_middle_name \"Middle name of the covered recipient physicia…\n10 covered_recipient_last_name   \"Last name of the covered recipient physician …\n# ℹ 81 more rows\n```\n\n\n:::\n:::\n\n### Ownership Payment File\n\n::: {.cell}\n\n```{.r .cell-code}\ndict_owner <- dataset$Ownership |> \n  sbt(year == \"2023\") |> \n  get_dictionary()\n\ndict_owner\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"Ownership Payment File Attributes\"\n\n$dictionary\n# A tibble: 30 × 2\n   field                                           description                  \n   <chr>                                           <chr>                        \n 1 change_type                                     \"An indicator showing if the…\n 2 physician_profile_id                            \"Open Payments system-genera…\n 3 physician_npi                                   \"National Provider Identifie…\n 4 physician_first_name                            \"First name of the physician…\n 5 physician_middle_name                           \"Middle name of the physicia…\n 6 physician_last_name                             \"Last name of the physician …\n 7 physician_name_suffix                           \"Name suffix of the physicia…\n 8 recipient_primary_business_street_address_line1 \"The first line of the prima…\n 9 recipient_primary_business_street_address_line2 \"The second line of the prim…\n10 recipient_city                                  \"The primary practice city o…\n# ℹ 20 more rows\n```\n\n\n:::\n:::\n\n### Ownership Payment File\n\n::: {.cell}\n\n```{.r .cell-code}\ndict_research <- dataset$Research |> \n  sbt(year == \"2023\") |> \n  get_dictionary()\n\ndict_research\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$title\n[1] \"Research Payment File Attributes\"\n\n$dictionary\n# A tibble: 252 × 2\n   field                            description                                 \n   <chr>                            <chr>                                       \n 1 change_type                      \"An indicator showing if the payment record…\n 2 covered_recipient_type           \"An indicator showing if the recipient of t…\n 3 noncovered_recipient_entity_name \"The name of the non-covered recipient enti…\n 4 teaching_hospital_ccn            \"A unique identifying number (CMS Certifica…\n 5 teaching_hospital_id             \"System generated unique identifier of the …\n 6 teaching_hospital_name           \"The name of the Teaching Hospital receivin…\n 7 covered_recipient_profile_id     \"System generated unique identifier for cov…\n 8 covered_recipient_npi            \"National Provider Identifier is a unique i…\n 9 covered_recipient_first_name     \"First name of the physician (covered recip…\n10 covered_recipient_middle_name    \"Middle name of the covered recipient physi…\n# ℹ 242 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [
      "faq_openpay_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}