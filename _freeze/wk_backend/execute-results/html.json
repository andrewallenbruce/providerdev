{
  "hash": "9d686c4283b67cabc243ca9e26ff05c9",
  "result": {
    "engine": "knitr",
    "markdown": "# Backend {#sec-backend}\n\n\n\n## `S7` Classes\n\n### `class_catalog`\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_catalog <- new_class(\n  name = \"class_catalog\",\n  properties = list(\n    groups = class_list),\n  validator = function(self) \n    if (!rlang::is_named(self@groups)) \"all @groups must be named\"\n  )\n\nclass_catalog(groups = list(npi = 1, ccn = \"clinicians\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<class_catalog>\n @ groups:List of 2\n .. $ npi: num 1\n .. $ ccn: chr \"clinicians\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntry(class_catalog(groups = list(1, \"clinicians\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nError : <class_catalog> object is invalid:\n- all @groups must be named\n```\n\n\n:::\n:::\n\n## National Downloadable File\n\n::: {.cell}\n\n```{.r .cell-code}\nndf_identifier <- \\(x) {\n  kit::nswitch(x,\n    \"affiliations\", \"27ea-46a8\",\n    \"clinicians\", \"mj5m-pzi6\",\n    default = NA_character_,\n    nThread = 4L)\n}\n\nhttr2::url_parse(\"https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/\")\n\nurl_tmp <- httr2::url_parse(\"https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/\") |> \n  httr2::url_build() |> \n  httr2::request()\n\nhttr2::req_template(\n  url_tmp, \n  \"/{fname}?show-reference-ids=true\", \n  fname = ndf_identifier(\"affiliations\"))\n\nhttr2::url_parse(\"https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/\") |> \n  httr2::url_build() |> \n  httr2::request() |> \n  httr2::req_url_path_append(ndf_identifier(\"affiliations\")) |> \n  httr2::req_url_path_append(\"?show-reference-ids=true\") |>\n  httr2::req_perform() |>\n  httr2::resp_body_json(check_type = FALSE, simplifyVector = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$accessLevel\n[1] \"public\"\n\n$landingPage\n[1] \"https://data.cms.gov/provider-data/dataset/27ea-46a8\"\n\n$bureauCode\n[1] \"009:38\"\n\n$issued\n[1] \"2023-08-17\"\n\n$`@type`\n[1] \"dcat:Dataset\"\n\n$modified\n[1] \"2025-03-07\"\n\n$released\n[1] \"2025-03-20\"\n\n$keyword\n                            identifier       data\n1 f62da856-f3e0-565a-a6e0-f6aefcafde00 Clinicians\n\n$contactPoint\n$contactPoint$`@type`\n[1] \"vcard:Contact\"\n\n$contactPoint$fn\n[1] \"CMS\"\n\n$contactPoint$hasEmail\n[1] \"mailto:QPP@cms.hhs.gov\"\n\n\n$publisher\n$publisher$identifier\n[1] \"4c1de1c4-f083-5877-8968-7ddc04756c49\"\n\n$publisher$data\n$publisher$data$`@type`\n[1] \"org:Organization\"\n\n$publisher$data$name\n[1] \"Centers for Medicare & Medicaid Services (CMS)\"\n\n\n\n$identifier\n[1] \"27ea-46a8\"\n\n$description\n[1] \"This is the facility affiliations data publicly reported in the Provider Data Catalog.\"\n\n$title\n[1] \"Facility Affiliation Data\"\n\n$programCode\n[1] \"009:000\"\n\n$distribution\n                            identifier        data.@type\n1 efbf0529-5062-5fc1-a233-66efcd087cfb dcat:Distribution\n                                                                                                                       data.downloadURL\n1 https://data.cms.gov/provider-data/sites/default/files/resources/b7c4080ae144663e43353a9c35cd3f53_1741377912/Facility_Affiliation.csv\n  data.mediaType\n1       text/csv\n                                                                                                                                                                                                                                                                                                                                                                                                                                    data.%Ref:downloadURL\n1 b7c4080ae144663e43353a9c35cd3f53__1741377912__source, b7c4080ae144663e43353a9c35cd3f53__1741377912__local_url, s3://211125755750-pdc-prod-dac-data/Facility_Affiliation.csv, https://h-o.st/provider-data/sites/default/files/resources/b7c4080ae144663e43353a9c35cd3f53_1741377912/Facility_Affiliation.csv, b7c4080ae144663e43353a9c35cd3f53, b7c4080ae144663e43353a9c35cd3f53, text/csv, text/csv, source, local_url, 1741377912, 1741377912, NA, NA\n\n$theme\n                            identifier                   data\n1 2d4e6b14-abb6-5b27-8e8d-047c7832ac1d Doctors and clinicians\n\n$archiveExclude\n[1] FALSE\n\n$`%modified`\n[1] \"2025-03-07T15:05:12-0500\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmeta_ndf <- \\(fname) {\n  \n  stopifnot(curl::has_internet())\n  \n  x <- request(\n    paste0(\n      \"https://data.cms.gov/\",\n      \"provider-data/api/1/\",\n      \"metastore/schemas/\",\n      \"dataset/items/\",\n      switch(fname, \n             affiliations = \"27ea-46a8\", \n             clinicians   = \"mj5m-pzi6\", \n             stop(\"Invalid argument\")),\n    \"?show-reference-ids=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type     = FALSE,\n         simplifyVector = TRUE)\n  \n  distro <- gelm(gelm(x, \"distribution\"), \"identifier\")\n  \n  y <- request(\n    paste0(\n    \"https://data.cms.gov/\", \n    \"provider-data/api/1/\",\n    \"datastore/query/\", \n    distro, \n    \"?limit=1&offset=100&\",\n    \"count=true&results=true&\", \n    \"schema=true&keys=true&\",\n    \"format=json&rowIds=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type     = FALSE,\n         simplifyVector = TRUE)\n  \n  z <- gelm(gelm(gelm(y, \"schema\"), distro), \"fields\")\n  \n  list(\n    title        = gelm(x, \"title\"),\n    description  = gelm(x, \"description\"),\n    identifier   = gelm(gelm(x, \"identifier\"), \"identifier\"),\n    distribution = distro,\n    issued       = gelm(x, \"issued\"),\n    modified     = gelm(x, \"modified\")[[1]],\n    released     = gelm(x, \"released\"),\n    dimensions   = paste0(gelm(gelm(y, \"count\"), is.numeric), \" x \", gelm(gelm(z, \"record_number\"), \"length\")),\n    fields       = names(z),\n    site         = gelm(x, \"landingPage\"),\n    csv          = gelm(gelm(gelm(x, \"distribution\"), \"data\"), \"downloadURL\", m = \"df\"),\n    dictionary   = paste0(\n      \"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"\n    )\n  )\n  \n}\n```\n:::\n\n### Examples\n\n::: {.cell}\n\n```{.r .cell-code}\nmeta_ndf(\"affiliations\") |> \n  purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $title        c1  Facility Affiliation Data\n- $description  c1  This is the facility affiliations data publicly reporte ...\n- $identifier   c1  27ea-46a8\n- $distribution c1  efbf0529-5062-5fc1-a233-66efcd087cfb\n- $issued       c1  2023-08-17\n- $modified     c1  2025-03-07\n- $released     c1  2025-03-20\n- $dimensions   c1  1565148 x 10\n- $fields       c10 record_number npi ind_pac_id provider_last_name provide ...\n- $site         c1  https://data.cms.gov/provider-data/dataset/27ea-46a8\n- $csv          c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n- $dictionary   c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeta_ndf(\"clinicians\") |> \n  purse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $title        c1  National Downloadable File\n- $description  c1  The Doctors and Clinicians national downloadable file i ...\n- $identifier   c1  mj5m-pzi6\n- $distribution c1  4d332c5c-900d-5b33-9e48-cc2dde7a6b5f\n- $issued       c1  2023-08-17\n- $modified     c1  2025-03-07\n- $released     c1  2025-03-20\n- $dimensions   c1  2667516 x 10\n- $fields       c32 record_number npi ind_pac_id ind_enrl_id provider_last_ ...\n- $site         c1  https://data.cms.gov/provider-data/dataset/mj5m-pzi6\n- $csv          c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n- $dictionary   c1  https://data.cms.gov/provider-data/sites/default/files/ ...\n```\n\n\n:::\n:::\n",
    "supporting": [
      "wk_backend_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}