{
  "hash": "393a4e354ab46179f5905ff021e773bf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"API FAQ\"\neditor_options: \n   chunk_output_type: console\n---\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<a href=\"https://data.cms.gov/api-docs\" class=\"btn btn-outline-secondary\" role=\"button\" target=\"_blank\">\n<i class=\"bi bi-box-arrow-up-right\"></i>\nCMS API Docs\n</a>\n<a href=\"https://data.cms.gov/sites/default/files/2024-10/7ef65521-65a4-41ed-b600-3a0011f8ec4b/API%20Guide%20Formatted%201_6.pdf\" class=\"btn btn-outline-secondary\" role=\"button\" target=\"_blank\">\n<i class=\"bi bi-box-arrow-up-right\"></i>\nAPI FAQ\n</a>\n```\n\n:::\n:::\n\nThe **data.CMS.gov/data.json** API:\n\n   * offers access to CMS public data\n   * is REST-ful\n   * has predictable resource-oriented URLs\n   * accepts form-encoded requests\n   * returns JSON & JSON:API responses\n   * uses standard HTTP response codes.\n\n## API Integration\n\nTo integrate endpoint requests with the **data.cms.gov Public API**, follow these steps:\n\n   1. Dataset & Identifier: \n      * [Search for dataset](https://data.cms.gov/search) and visit its **overview** page\n      * Click on **Access API**, then **API Docs for the Dataset**\n   2. Endpoint structure:\n      * `data.cms.gov/data-api/v1/dataset/{{dataset_id}}/data` \n   3. System uses **JSONAPI** query syntax:\n      * Key-values: `?filter[field_name]=value&filter[field_other]=value`\n      * Responses are paged and support a max page size of 5000 rows\n      * Use the `size` & `offset` query parameters to page through the data\n\n### Query Syntax\n\n**Exact Match Search on Column**:\n\n```r\n- dataset   Medicare Fee-For-Service Public Provider Enrollment\n  column    PROVIDER_TYPE_DESC \n  equals    PRACTITIONER-GENERAL PRACTICE\n\ncall:     /data?\n          filter[PROVIDER_TYPE_DESC]=PRACTITIONER%20-%20GENERAL%20PRACTICE\n```\n\n**Contains Search on Column**:\n\n```r\n- dataset  Medicare Fee-For-Service Public Provider Enrollment\n  column   PROVIDER_TYPE_DESC\n  contains SUPPLIER\n\ncall:    /data?\n          filter[example][condition][path]=PROVIDER_TYPE_DESC\n         &filter[example][condition][operator]=CONTAINS\n         &filter[example][condition][value]=SUPPLIER\n```\n\n**Combination search on 2 columns:** \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n- dataset  Medicare Fee-For-Service Public Provider Enrollment\n  column   PROVIDER_TYPE_DESC\n  contains PRACTITIONER\n  column   STATE_CD\n  equals   MD\n\ncall:    /data?\n          filter[filter-1][condition][path]=PROVIDER_TYPE_DESC\n         &filter[filter-1][condition][operator]=CONTAINS\n         &filter[filter-1][condition][value]=PRACTITIONER\n         &filter[filter-2][condition][path]=STATE_CD\n         &filter[filter-2][condition][operator]==\n         &filter[filter-2][condition][value]=MD\n```\n:::\n\n[Refer to the Drupal documentation](https://www.drupal.org/docs/core-modules-and-themes/core-modules/jsonapi-module/filtering) for more information on filtering API requests.\n\n--------------------------------------------------------------------------------\n\n# Data Catalog file\n\nThe [`data.json`](https://data.cms.gov/data.json) file is an [**Open Data**](https://resources.data.gov/resources/dcat-us/) catalog containing all available datasets. As new data is added, `data.json` is automatically updated.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata_json <- read_json_arrow(\n  file = \"https://data.cms.gov/data.json\",\n  col_select = c(\"dataset\"),\n    as_data_frame = TRUE) |> \n  to_duckdb()\n\ndata_json |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: ??\nColumns: 1\nDatabase: DuckDB v1.1.3 [Andrew@Windows 10 x64:R 4.4.2/:memory:]\n$ dataset <list> [<data.frame[139 x 22]>]\n```\n\n\n:::\n:::\n\n\n> **Note:** Removing `col_select = c(\"dataset\")` from the above call returns the following metadata:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n@context    <chr> https://project-open-data.cio.gov/v1.1/schema/catalog.jsonld\n@id         <chr> https://data.cms.gov/data.json\n@type       <chr> dcat:Catalog\nconformsTo  <chr> https://project-open-data.cio.gov/v1.1/schema\ndescribedBy <chr> https://project-open-data.cio.gov/v1.1/schema/catalog.json\ndataset     <list> [<data.frame[138 x 22]>]\n```\n\n\n:::\n:::\n\n\nWithin `data.json`, there is an array called `dataset`. One can search through this array using the dataset's `title`, such as `\"Payroll Based Journal Daily Nurse Staffing\"`:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata_json |> \n  pull(dataset) |> \n  pluck(1) |> \n  filter(\n    grepl(\n      \"Payroll Based Journal Daily Nurse Staffing\", \n      title)) |> \n  mutate(\n    bureauCode = delist(bureauCode),\n    keyword = map_chr(\n      keyword, \n      \\(x) paste0(\n        delist(x), \n        collapse = \", \")),\n    language = delist(language),\n    programCode = delist(programCode),\n    references = delist(references),\n    theme = delist(theme)) |> \n  unnest_wider(contactPoint, names_sep = \"_\") |>\n  unnest_wider(publisher, names_sep = \"_\") |>\n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $@type                 c1 dcat:Dataset                                                                  ...\n- $accessLevel           c1 public                                                                        ...\n- $accrualPeriodicity    c1 R/P3M                                                                         ...\n- $bureauCode            c1 009:38                                                                        ...\n- $contactPoint_@type    c1 vcard:Contact                                                                 ...\n- $contactPoint_fn       c1 Nursing Home Staffing - CCSQ (PBJ Reports)                                    ...\n- $contactPoint_hasEmail c1 mailto:nhstaffing@cms.hhs.gov                                                 ...\n- $describedBy           c1 https://data.cms.gov/resources/payroll-based-journal-daily-nurse-staffing-dat ...\n- $dataQuality           l1 T                                                                             ...\n- $description           c1 The Payroll Based Journal (PBJ) Nurse Staffing and Non-Nurse Staffing dataset ...\n- $distribution          L1 list(structure(list(\"@type\" = c(\"dcat:Distribution\", \"dcat:Distribution\", \"dc ...\n- $identifier            c1 https://data.cms.gov/data-api/v1/dataset/7e0d53ba-8f02-4c66-98a5-14a1c997c50d ...\n- $keyword               c1 Medicare, Original Medicare, Hospitals & Facilities, Skilled Nursing, Health  ...\n- $landingPage           c1 https://data.cms.gov/quality-of-care/payroll-based-journal-daily-nurse-staffi ...\n- $language              c1 en-US                                                                         ...\n- $license               c1 https://www.usa.gov/government-works                                          ...\n- $modified              p1 2024-10-31                                                                    ...\n- $programCode           c1 009:000                                                                       ...\n- $publisher_@type       c1 org:Organization                                                              ...\n- $publisher_name        c1 Centers for Medicare & Medicaid Services                                      ...\n- $references            c1 https://data.cms.gov/resources/payroll-based-journal-methodology-0            ...\n- $temporal              c1 2017-01-01/2024-06-30                                                         ...\n- $theme                 c1 Medicare                                                                      ...\n- $title                 c1 Payroll Based Journal Daily Nurse Staffing                                    ...\n- $describedByType       c1 NA                                                                            ...\n```\n\n\n:::\n:::\n\n\nWithin `dataset`, there is an array called `distribution` which contains all dataset versions, in all available formats:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndistribution <- data_json |> \n  pull(dataset) |> \n  pluck(1) |> \n  select(distribution) |> \n  unnest(distribution)\n\ndistribution\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3,897 × 10\n   `@type`   format accessURL resourcesAPI description title modified           \n   <chr>     <chr>  <chr>     <chr>        <chr>       <chr> <dttm>             \n 1 dcat:Dis… API    https://… https://dat… latest      Acco… 2024-01-29 00:00:00\n 2 dcat:Dis… <NA>   <NA>      https://dat… <NA>        Acco… 2024-01-29 00:00:00\n 3 dcat:Dis… API    https://… https://dat… <NA>        Acco… 2024-01-29 00:00:00\n 4 dcat:Dis… <NA>   <NA>      https://dat… <NA>        Acco… 2023-03-06 00:00:00\n 5 dcat:Dis… API    https://… https://dat… <NA>        Acco… 2023-03-06 00:00:00\n 6 dcat:Dis… <NA>   <NA>      https://dat… <NA>        Acco… 2022-01-26 00:00:00\n 7 dcat:Dis… API    https://… https://dat… <NA>        Acco… 2022-01-26 00:00:00\n 8 dcat:Dis… <NA>   <NA>      https://dat… <NA>        Acco… 2022-01-27 00:00:00\n 9 dcat:Dis… API    https://… https://dat… <NA>        Acco… 2022-01-27 00:00:00\n10 dcat:Dis… <NA>   <NA>      https://dat… <NA>        Acco… 2022-01-27 00:00:00\n# ℹ 3,887 more rows\n# ℹ 3 more variables: temporal <chr>, downloadURL <chr>, mediaType <chr>\n```\n\n\n:::\n:::\n\n## Formats\n\n   * __description__ `\"latest\"` is a URL that always point to the latest data\n   * __mediaType__ `\"text/csv\"` is a downloadable CSV file\n   * __mediaType__ `\"application/zip\"` is a downloadable ZIP file\n   * __format__ `\"API\"` is an API endpoint\n   * Remaining entries provide references to the data at fixed points in time, listed in descending order by date.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndistribution |> \n  count(description, \n        format, \n        mediaType) |> \n  as_emphatic() |> \n  hl(ggplot2::scale_colour_viridis_c(), cols = \"n\") |>\n  hl_adjust(text_contrast = 0.5, na = \"-\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<pre style=''>\n<span style='text-decoration:underline;'>    description format                mediaType    n</span><br/>1  <span style='color:#808080;'><span>      latest</span></span><span style='color:#808080;'><span>    API</span></span><span style='color:#808080;'><span>                        -</span></span><span style='color:#a38db1;'><span style='background-color:#461a62;'>  112</span></span><br/>2  <span style='color:#808080;'><span>           -</span></span><span style='color:#808080;'><span>    API</span></span><span style='color:#808080;'><span>                        -</span></span><span style='color:#7f7413;'><span style='background-color:#fde725;'> 1626</span></span><br/>3  <span style='color:#808080;'><span>           -</span></span><span style='color:#808080;'><span>      -</span></span><span style='color:#808080;'><span> application/vnd.ms-excel</span></span><span style='color:#a280aa;'><span style='background-color:#440154;'>   21</span></span><br/>4  <span style='color:#808080;'><span>           -</span></span><span style='color:#808080;'><span>      -</span></span><span style='color:#808080;'><span>          application/zip</span></span><span style='color:#9cb1c5;'><span style='background-color:#39638b;'>  534</span></span><br/>5  <span style='color:#808080;'><span>           -</span></span><span style='color:#808080;'><span>      -</span></span><span style='color:#808080;'><span>                 text/csv</span></span><span style='color:#7b7315;'><span style='background-color:#f5e62a;'> 1604</span></span><br/>\n</pre>\n`````\n:::\n:::\n\nFor example, the URL in the following example will *always* point to the **Payroll Based Journal Daily Nurse Staffing** data from **Q2 2021**:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"https://data.cms.gov/data-api/v1/dataset/d10d792e-ea6e-4145-8512-34efbc1be04b/data\"\nstaffing <- distribution |> \n  filter(\n    grepl(\"Payroll Based Journal Daily Nurse Staffing\", title),\n    format == \"API\",\n    grepl(\"^2021-04\", temporal)) |> \n  pull(accessURL) |> \n  request() |> \n  req_perform() |> \n  resp_body_json(simplifyVector = TRUE)\n\nhead(staffing, 1) |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $PROVNUM          c1 015010                        \n- $PROVNAME         c1 COOSA VALLEY HEALTHCARE CENTER\n- $CITY             c1 SYLACAUGA                     \n- $STATE            c1 AL                            \n- $COUNTY_NAME      c1 Talladega                     \n- $COUNTY_FIPS      c1 121                           \n- $CY_Qtr           c1 2021Q2                        \n- $WorkDate         c1 20210401                      \n- $MDScensus        c1 70                            \n- $Hrs_RNDON        c1 8                             \n- $Hrs_RNDON_emp    c1 8                             \n- $Hrs_RNDON_ctr    c1 0                             \n- $Hrs_RNadmin      c1 48.25                         \n- $Hrs_RNadmin_emp  c1 48.25                         \n- $Hrs_RNadmin_ctr  c1 0                             \n- $Hrs_RN           c1 32                            \n- $Hrs_RN_emp       c1 32                            \n- $Hrs_RN_ctr       c1 0                             \n- $Hrs_LPNadmin     c1 0                             \n- $Hrs_LPNadmin_emp c1 0                             \n- $Hrs_LPNadmin_ctr c1 0                             \n- $Hrs_LPN          c1 63.25                         \n- $Hrs_LPN_emp      c1 63.25                         \n- $Hrs_LPN_ctr      c1 0                             \n- $Hrs_CNA          c1 189.5                         \n- $Hrs_CNA_emp      c1 189.5                         \n- $Hrs_CNA_ctr      c1 0                             \n- $Hrs_NAtrn        c1 0                             \n- $Hrs_NAtrn_emp    c1 0                             \n- $Hrs_NAtrn_ctr    c1 0                             \n- $Hrs_MedAide      c1 0                             \n- $Hrs_MedAide_emp  c1 0                             \n- $Hrs_MedAide_ctr  c1 0                             \n```\n\n\n:::\n:::\n\n## Temporal Data\n\nDatasets with multiple historical versions available will have a `temporal` field in the `distribution` array of the `data.json` file which will indicate the time period.\n\n**Format**: `yyyy-mm-dd/yyyy-mm-dd`\n\nThe following example finds the API link for the [2017 Medicare Inpatient Hospitals - by Provider and Service Data](https://data.cms.gov/provider-summary-by-type-of-service/medicare-inpatienthospitals/medicare-inpatient-hospitals-by-provider-and-service):\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndistribution |> \n  filter(\n    grepl(\"Medicare Inpatient Hospitals - by Provider and Service\", title), \n    format == \"API\",\n    temporal == \"2017-01-01/2017-12-31\") |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $@type        c1 dcat:Distribution                                                                      \n- $format       c1 API                                                                                    \n- $accessURL    c1 https://data.cms.gov/data-api/v1/dataset/b61ba5eb-021b-4510-947e-0f198982b0e8/data     \n- $resourcesAPI c1 https://data.cms.gov/data-api/v1/dataset-resources/b61ba5eb-021b-4510-947e-0f198982b0e8\n- $description  c1 NA                                                                                     \n- $title        c1 Medicare Inpatient Hospitals - by Provider and Service : 2017-12-31                    \n- $modified     p1 2023-05-10                                                                             \n- $temporal     c1 2017-01-01/2017-12-31                                                                  \n- $downloadURL  c1 NA                                                                                     \n- $mediaType    c1 NA                                                                                     \n```\n\n\n:::\n:::\n\n## Methods: Same Data, Different Output\n\nThere are two methods of accessing the latest data. \n\nBoth result in a URL pointing to the most recent version of the dataset. This URL is canonical, i.e., will not change as new versions are added. \n\nFor this reason, it is _recommended to **always** start with the **`data.json` object** as opposed to hardcoding any URL_.\n\n### Method 1: Standard JSON\n\n```r\n<data_json>\n    => <dataset> \n    => <distribution> \n    -> $(description == \"latest\")\n    -> $(accessURL)\n```\nUse the `distribution` with the \"latest\" `description`. This URL returns **standard JSON**.\n\n> For example, this URL for Opt Out Affidavits is \n> `\"https://data.cms.gov/dataapi/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data\"` \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\njson_standard <- distribution |> \n  filter(\n    grepl(\"Order and Referring\", title),\n    description == \"latest\")\n\njson_standard |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $@type        c1 dcat:Distribution                                                                      \n- $format       c1 API                                                                                    \n- $accessURL    c1 https://data.cms.gov/data-api/v1/dataset/c99b5865-1119-4436-bb80-c5af2773ea1f/data     \n- $resourcesAPI c1 https://data.cms.gov/data-api/v1/dataset-resources/c99b5865-1119-4436-bb80-c5af2773ea1f\n- $description  c1 latest                                                                                 \n- $title        c1 Order and Referring : 2024-12-20                                                       \n- $modified     p1 2024-12-20                                                                             \n- $temporal     c1 2024-12-08/2024-12-14                                                                  \n- $downloadURL  c1 NA                                                                                     \n- $mediaType    c1 NA                                                                                     \n```\n\n\n:::\n:::\n\n### Method 2: JSON:API\n\n```r\n<data_json>\n    => <dataset> \n    -> $(title == \"Order and Referring\")\n    -> $(identifier)\n```\n\nUse the URL in the `identifier` field. \n\nThis URL returns JSON in the **JSON:API** form. It has a different response structure that includes metadata about the dataset. Otherwise it is identical to Method 1. \n\n> For example, this URL for Opt Out Affidavits: \n> `\"https://data.cms.gov/dataapi/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data-viewer\"`\n\nThe following example finds the API link for the latest [Order and Referring](https://data.cms.gov/provider-characteristics/medicare-provider-supplierenrollment/order-and-referring) Data:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\njson_api <- data_json |> \n  pull(dataset) |> \n  pluck(1) |> \n  dplyr::tibble() |> \n  filter(\n    grepl(\n      \"Order and Referring\", \n      title))\n\njson_api |> \n  mutate(\n    bureauCode = delist(bureauCode),\n    keyword = map_chr(\n      keyword, \n      \\(x) paste0(\n        delist(x), \n        collapse = \", \")),\n    language = delist(language),\n    programCode = delist(programCode),\n    references = delist(references),\n    theme = delist(theme)) |> \n  unnest_wider(contactPoint, names_sep = \"_\") |>\n  unnest_wider(publisher, names_sep = \"_\") |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $@type                 c1 dcat:Dataset                                                                  ...\n- $accessLevel           c1 public                                                                        ...\n- $accrualPeriodicity    c1 R/P3.5D                                                                       ...\n- $bureauCode            c1 009:38                                                                        ...\n- $contactPoint_@type    c1 vcard:Contact                                                                 ...\n- $contactPoint_fn       c1 Provider Enrollment Data Requests - CPI                                       ...\n- $contactPoint_hasEmail c1 mailto:ProviderEnrollmentDataRequests@cms.hhs.gov                             ...\n- $describedBy           c1 https://data.cms.gov/resources/order-and-referring-data-dictionary            ...\n- $dataQuality           l1 T                                                                             ...\n- $description           c1 The Order and Referring dataset provides information on all physicians and no ...\n- $distribution          L1 list(structure(list(\"@type\" = c(\"dcat:Distribution\", \"dcat:Distribution\", \"dc ...\n- $identifier            c1 https://data.cms.gov/data-api/v1/dataset/c99b5865-1119-4436-bb80-c5af2773ea1f ...\n- $keyword               c1 Medicare, Original Medicare, Provider Enrollment                              ...\n- $landingPage           c1 https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enro ...\n- $language              c1 en-US                                                                         ...\n- $license               c1 https://www.usa.gov/government-works                                          ...\n- $modified              p1 2024-12-20                                                                    ...\n- $programCode           c1 009:000                                                                       ...\n- $publisher_@type       c1 org:Organization                                                              ...\n- $publisher_name        c1 Centers for Medicare & Medicaid Services                                      ...\n- $references            c1 https://data.cms.gov/resources/order-and-referring-methodology                ...\n- $temporal              c1 2023-05-21/2024-12-14                                                         ...\n- $theme                 c1 Medicare                                                                      ...\n- $title                 c1 Order and Referring                                                           ...\n- $describedByType       c1 NA                                                                            ...\n```\n\n\n:::\n:::\n\n--------------------------------------------------------------------------------\n\n# Pagination\n\nThe default is to provide the first 1,000 rows per request. However, there is an ability to increase the limit to 5,000 rows per request. You can use pagination to retrieve the entire dataset. \n\nFor example, with our [Opt Out Affidavits]() dataset:\n\n   1. Start with the following request to get the number of rows:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequest(\"https://data.cms.gov/data-api/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data/stats\") |>\n  req_perform() |> \n  resp_body_json(simplifyVector = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$found_rows\n[1] 47984\n\n$total_rows\n[1] 47984\n```\n\n\n:::\n:::\n      \n   2. Make a request for the *first* 5,000 rows:\n      \n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequest(\"https://data.cms.gov/data-api/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data?size=5000&offset=0\") |>\n  req_perform() |> \n  resp_body_json(simplifyVector = TRUE) |> \n  tibble() |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $First Name                  c5000 Jonathan     Kevin               David              Bruce            ...\n- $Last Name                   c5000 Raines       Carlson             Altchek            Shapiro          ...\n- $NPI                         c5000 1720444581   1811981905          1114974490         1548271240       ...\n- $Specialty                   c5000 Psychiatry   Internal Medicine   Orthopedic Surgery Psychiatry       ...\n- $Optout Effective Date       c5000 01/30/1998   07/01/2010          07/01/2012         12/28/2015       ...\n- $Optout End Date             c5000 01/30/2026   07/01/2026          07/01/2026         12/28/2025       ...\n- $First Line Street Address   c5000 1629 MONK RD 10700 CHARTER DRIVE 535 EAST 70TH ST   666 GLENBROK RD  ...\n- $Second Line Street Address  c5000 P O BOX 470                                                          ...\n- $City Name                   c5000 GLADWYNE     COLUMBIA            NEW YORK           STAMFORD         ...\n- $State Code                  c5000 PA           MD                  NY                 CT               ...\n- $Zip code                    c5000 190351349    21044               100214823          069061439        ...\n- $Eligible to Order and Refer c5000 N            Y                   Y                  Y                ...\n- $Last updated                c5000 02/15/2024   08/15/2024          08/15/2024         01/15/2024       ...\n```\n\n\n:::\n:::\n      \n   3. Make a request for the *next* 5,000 rows:\n   \n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequest(\"https://data.cms.gov/data-api/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data?size=5000&offset=5000\") |>\n  req_perform() |> \n  resp_body_json(simplifyVector = TRUE) |> \n  tibble() |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $First Name                  c5000 Katherine             Bret            Jeffrey           Lorna        ...\n- $Last Name                   c5000 Whipple               Jacobson        Zeller            Benjamin     ...\n- $NPI                         c5000 1184839557            1790893956      1730172248        1760572390   ...\n- $Specialty                   c5000 Clinical Psychologist Oral Surgery    Dentist           Clinical Psy ...\n- $Optout Effective Date       c5000 08/29/2013            06/28/2014      09/28/2022        07/01/2014   ...\n- $Optout End Date             c5000 08/29/2025            06/28/2026      09/28/2026        07/01/2026   ...\n- $First Line Street Address   c5000 10529 SAINT PAUL ST   1718 S 288TH ST 1101 S AIRLINE RD 455 E 200 S  ...\n- $Second Line Street Address  c5000                                                         STE 110      ...\n- $City Name                   c5000 KENSINGTON            FEDERAL WAY     MOUNT PLEASANT    SALT LAKE CI ...\n- $State Code                  c5000 MD                    WA              WI                UT           ...\n- $Zip code                    c5000 208952614             98003           534063888         841112156    ...\n- $Eligible to Order and Refer c5000 N                     Y               N                 Y            ...\n- $Last updated                c5000 09/15/2023            07/15/2024      11/15/2024        08/15/2024   ...\n```\n\n\n:::\n:::\n\n   4. Continue increasing the offset until you reach the count from step 1\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequest(\"https://data.cms.gov/data-api/v1/dataset/9887a515-7552-4693-bf58-735c77af46d7/data?size=5000&offset=10000\") |>\n  req_perform() |> \n  resp_body_json(simplifyVector = TRUE) |> \n  tibble() |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $First Name                  c5000 Steven               David                Michael             Frank  ...\n- $Last Name                   c5000 Glickman             Christensen          Ilardi              Shalle ...\n- $NPI                         c5000 1942372362           1255403606           1558440842          134630 ...\n- $Specialty                   c5000 Dentist              Dentist              Dentist             Intern ...\n- $Optout Effective Date       c5000 11/30/2015           11/30/2015           12/10/2015          01/01/ ...\n- $Optout End Date             c5000 11/30/2025           11/30/2025           12/10/2025          01/01/ ...\n- $First Line Street Address   c5000 71 FRANKLIN TURNPIKE 71 FRANKLIN TURNPIKE 2713 ROUTE 23 SOUTH 1231 C ...\n- $Second Line Street Address  c5000 #1-1                 #1-1                                            ...\n- $City Name                   c5000 WALDWICK             WALDWICK             NEWFOUNDLAND        CARSON ...\n- $State Code                  c5000 NJ                   NJ                   NJ                  NV     ...\n- $Zip code                    c5000 07463                07463                07435               897038 ...\n- $Eligible to Order and Refer c5000 Y                    Y                    Y                   Y      ...\n- $Last updated                c5000 12/15/2023           12/15/2023           01/15/2024          02/15/ ...\n```\n\n\n:::\n:::\n\n## Pagination Example\n\nPaginates through the [Opt Out Affidavits](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/opt-out-affidavits) data:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\noptout_n <- distribution |> \n  filter(\n    grepl(\"Opt Out Affidavits : \", title), \n    format == \"API\",\n    description == \"latest\") |> \n  str_glue_data(\"{accessURL}/stats\") |> \n  request() |> \n  req_perform() |> \n  resp_body_json()\n\noptout_n$total_rows / 5000\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 9.6\n```\n\n\n:::\n\n```{.r .cell-code}\n# req_perform_iterative()\n```\n:::\n\n## Find the Number of Rows\n\nUse the `stats` endpoints i.e., \n\n   * `data.cms.gov/data-api/v1/dataset/{ID}/data-viewer/stats`\n   * `data.cms.gov/data-api/v1/dataset/{ID}/data/stats`\n\n# Download CSV versions\n\n   1. Start with a request to the `data.json`. \n   2. Match the dataset `title` with its name.\n   3. The most recent release will be at the top of the `distribution` array. \n   4. There is also a `temporal` field which can be used to find earlier releases.\n   5. Datasets available as either CSV or ZIP files will be designated as such in the `mediaType` field.\n   6. The `downloadURL` field will provide a direct download link for the data.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\norderrefer_url <- distribution |> \n  filter(\n    grepl(\"Order and Referring\", title), \n    mediaType == \"text/csv\",\n    modified == max(modified)) |> \n  pull(downloadURL)\n  \norderrefer_csv <- read_csv_arrow(\n  file = orderrefer_url, \n  as_data_frame = TRUE) |> \n  to_duckdb()\n\n# approx 2 million rows\norderrefer_csv\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Source:   table<arrow_002> [?? x 8]\n# Database: DuckDB v1.1.3 [Andrew@Windows 10 x64:R 4.4.2/:memory:]\n          NPI LAST_NAME     FIRST_NAME PARTB DME   HHA   PMD   HOSPICE\n        <int> <chr>         <chr>      <chr> <chr> <chr> <chr> <chr>  \n 1 1558467555 .MCINDOE      THOMAS     N     Y     N     Y     N      \n 2 1770667479 A             SCOTT      N     Y     N     Y     N      \n 3 1417051921 A BELLE       N          Y     Y     Y     Y     N      \n 4 1356025894 A FOLEY       MEGAN      Y     Y     Y     Y     N      \n 5 1972040137 A NOVOTNY     ELIZABETH  Y     Y     Y     Y     N      \n 6 1760465553 A SATTAR      MUHAMMAD   Y     Y     Y     Y     Y      \n 7 1295400745 A'NEAL        BROGAN     Y     Y     N     N     N      \n 8 1265446264 A'VANT FOWLER CATHERINE  Y     Y     N     N     N      \n 9 1700562584 AAB           BAILEY     Y     Y     Y     N     Y      \n10 1205257284 AAB           KATIE      Y     Y     N     N     N      \n# ℹ more rows\n```\n\n\n:::\n:::\n\n::: callout\n\n## ZIP Example\n\n_CMS Summary Statistics/COVID data -> Likely not relevant to package scope_\n\n::: \n\n# _New:_ **Resources**\n\nResources (supplemental documents to the main dataset) are now available for download through the public API. Included are sub-files, tables, supplementary data, reports, and documentation. The new endpoints appear in the `resourcesAPI` field, a secondary endpoint from `data.json`. \n\n> **Note**: Limit by the `name` of the resource you want to download. This name may change between versions.\n\n## Example: Reassignment SubFile (`csv`)\n\nSite: [Public Provider Enrollment Reassignment SubFile](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/medicare-fee-for-service-public-provider-enrollment)\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresp_resources <- distribution |> \n  filter(\n  grepl(\"Medicare Fee-For-Service\", title),\n  description == \"latest\") |> \n  pull(resourcesAPI) |> \n  request() |> \n  req_perform() |> \n  resp_body_json(simplifyVector = FALSE) |> \n  list_flatten() |> \n  list_flatten()\n\nreassign_url <- tibble(\n  name = gelm(resp_resources, \"name$\") |> delist(),\n  size = gelm(resp_resources, \"fileSize$\") |> delist(),\n  url =  gelm(resp_resources, \"downloadURL$\") |> delist()) |> \n  filter(grepl(\"Reassignment\", name))\n\nreassign_url |> \n  terse(width = 110, prefix = \"- \", config = list(gsep = \" \", ansi = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- $name c1 Reassignment Sub-File 2024 Q3                                                                  ...\n- $size i1 108956340                                                                                      ...\n- $url  c1 https://data.cms.gov/sites/default/files/2024-10/9dc1f6a0-4339-4250-b9da-d25284650662/PPEF_Rea ...\n```\n\n\n:::\n\n```{.r .cell-code}\nreassign_csv <- read_csv_arrow(\n  file = reassign_url$url, \n  as_data_frame = TRUE) |> \n  to_duckdb()\n\nreassign_csv\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Source:   table<arrow_003> [?? x 2]\n# Database: DuckDB v1.1.3 [Andrew@Windows 10 x64:R 4.4.2/:memory:]\n   REASGN_BNFT_ENRLMT_ID RCV_BNFT_ENRLMT_ID\n   <chr>                 <chr>             \n 1 I20031103000001       O20031216000213   \n 2 I20031103000001       O20111004000177   \n 3 I20031103000007       O20040308000883   \n 4 I20031103000007       O20051206000046   \n 5 I20031103000014       O20070303000050   \n 6 I20031103000014       O20221026001638   \n 7 I20031103000020       O20190812002967   \n 8 I20031103000033       O20181107003537   \n 9 I20031103000033       O20181204002777   \n10 I20031103000037       O20051216000183   \n# ℹ more rows\n```\n\n\n:::\n:::\n\n# Filtering and Manipulating Data\n\n-------------------------------------------------------------------------------\n\n## Schema\n\n```r\n<data.json>\n  |--@context\n  |--@id\n  |--@type\n  |--conformsTo\n  |--describedBy\n  |==<dataset>\n  |    |--@type\n  |    |--accessLevel\n  |    |--accrualPeriodicity\n  |    |--bureauCode\n  |    |--contactPoint\n  |    |--describedBy\n  |    |--dataQuality\n  |    |--description\n  |    |==<distribution>\n  |    |    |--@type\n  |    |    |--format\n  |    |    |--accessURL\n  |    |    |--resourcesAPI\n  |    |    |--description\n  |    |    |--title\n  |    |    |--modified\n  |    |    |--temporal\n  |    |    |--downloadURL\n  |    |    |--mediaType\n  |    |--identifier\n  |    |--keyword\n  |    |--landingPage\n  |    |--language\n  |    |--license\n  |    |--modified\n  |    |--programCode\n  |    |--publisher\n  |    |--references\n  |    |--temporal\n  |    |--theme\n  |    |--title\n  |____|--describedByType\n```\n",
    "supporting": [
      "faq_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}