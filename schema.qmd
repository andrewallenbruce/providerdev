---
title: "Schema"
editor_options: 
   chunk_output_type: console
---

```{r setup}
#| echo: false
#| message: false
#| warning: false
knitr::opts_chunk$set(
  dev        = "ragg_png",
  dpi        = 320,
  out.width  = "100%",
  fig.width  = 8,
  fig.asp    = 0.818,
  fig.retina = 2,
  fig.align  = "center",
  fig.show   = "hold"
)
options(scipen = 999, digits = 3)

source("_common.R")

library(tidyverse)
library(provider)
library(httr2)
```

```{r}
#| echo: false
htmltools::tagList(
  btn_link("https://resources.data.gov/resources/dcat-us/", "DCAT Schema v1.1"),
  btn_link("https://resources.data.gov/schemas/dcat-us/v1.1/iso8601_guidance/#accrualperiodicity", "ISO8601 Guidance"))
```

# `dataset` Fields

## `bureauCode`

Federal agencies, combined agency and bureau code from [OMB Circular A-11, Appendix C](https://obamawhitehouse.archives.gov/sites/default/files/omb/assets/a11_current_year/app_c.pdf) in the format of `015:11`.

```{r}
#| label: bureauCode
#| echo: false
bureauCode <- readr::read_csv(
  here::here("data/omb_bureau_codes.csv"), 
  show_col_types = FALSE,
  col_types = readr::cols(
  agency_name = readr::col_character(),
  bureau_name = readr::col_character(),
  agency_code = readr::col_character(),
  bureau_code = readr::col_character(),
  treasury_code = readr::col_character(),
  cgac_code = readr::col_character()),
  name_repair = janitor::make_clean_names) |> 
  dplyr::mutate(
    agency_code = stringr::str_pad(agency_code, width = 3, pad = "0"),
    bureau_code = stringr::str_pad(bureau_code, width = 2, pad = "0"),
    treasury_code = stringr::str_pad(treasury_code, width = 2, pad = "0"),
    cgac_code = stringr::str_pad(cgac_code, width = 3, pad = "0"))

bureauCode
```

## `programCode`

Federal agencies, list the primary program related to this data asset, from the [Federal Program Inventory](https://resources.data.gov/schemas/dcat-us/v1.1/FederalProgramInventory_FY13_MachineReadable_091613.csv). Use the format of `015:001`.

```{r}
#| label: programCode
#| echo: false
programCode <- readr::read_csv(
  here::here("data/FederalProgramInventory_FY13_MachineReadable_091613.csv"), 
  show_col_types = FALSE,
  col_types = readr::cols(
  agency_name = readr::col_character(),
  program_name = readr::col_character(),
  additional_information_optional = readr::col_character(),
  agency_code = readr::col_character(),
  program_code = readr::col_character(),
  program_code_pod_format = readr::col_character()),
  name_repair = janitor::make_clean_names)

programCode
```

## `accrualPeriodicity`

```{r}
#| label: accrualPeriodicity
#| echo: false
accrual_key <- c("
Term 	                ISO_8601
Decennial 	          R/P10Y
Quadrennial 	        R/P4Y
Annual 	              R/P1Y
Bimonthly 	          R/P2M or R/P0.5M
Semiweekly 	          R/P3.5D
Daily 	              R/P1D
Biweekly 	            R/P2W or R/P0.5W
Semiannual 	          R/P6M
Biennial 	            R/P2Y
Triennial 	          R/P3Y
Three times a week 	  R/P0.33W
Three times a month 	R/P0.33M
Continuously updated 	R/PT1S
Monthly             	R/P1M
Quarterly 	          R/P3M
Semimonthly 	        R/P0.5M
Three times a year 	  R/P4M
Weekly 	              R/P1W
Hourly 	              R/PT1H
")

accrual_key <- gsub(" \t", ", ", accrual_key)
accrual_key <- gsub("^\n|\n$", "", accrual_key)
accrual_key <- strsplit(accrual_key, "\n")[[1]]
accrual_key <- strsplit(accrual_key, ", ")
accrual_key <- trimws(unlist(accrual_key))
accrual_key <- accrual_key[c(-1, -2)]

data.frame(
 term = accrual_key[c(TRUE, FALSE)],
 iso_8601 = accrual_key[c(FALSE, TRUE)])
```

