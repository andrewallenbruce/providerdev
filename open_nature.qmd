---
editor_options: 
   chunk_output_type: console
---

```{r}
#| label: setup-common-01
#| include: false
#| warning: false
source("includes/_common.R")
```

# Summary Nature {#sec-opennature}

> Groups payment data by state, recipient type, and nature of payment

This dataset is pre-filtered based on the most frequent searches of Open Payments data.

### Metadata

```{r}
#| label: s7_object
#| echo: false
end  <- open_endpoint("summary_nature")
print_meta(end)
```

## Data

```{r}
#| label: http_request
#| message: true
#| echo: false
resp <- quick("summary_nature", limit = 500)
resp
```

## Tidyup

```{r}
#| label: tidyup
#| message: false
#| echo: true
x <- resp |>
  as_tbl() |>
  mtt(recipient_type = providertwo:::clean_names(recipient_type)) |>
  rsplit(~ recipient_type)

x$covered_recipient_physician <- fcompute(
  x$covered_recipient_physician,
  year            = factor_(program_year),
  payment_type    = factor_(payment_type),
  recipient_type  = "Physician",
  recipient_n     = as.integer(total_number_of_physicians),
  payment_sum     = as.numeric(total_payment_amount_physician),
  payment_mean    = as.numeric(mean_total_payment_amount_physician),
  payment_median  = as.numeric(median_total_payment_amount_physician),
  payments_n      = as.integer(total_payment_count_physician),
  payments_mean   = as.double(mean_total_payment_count_physician),
  payments_median = as.double(median_total_payment_count_physician)
)

x$covered_recipient_non_physician_practitioner <- fcompute(
  x$covered_recipient_non_physician_practitioner,
  year            = factor_(program_year),
  payment_type    = factor_(payment_type),
  recipient_type  = "Non-Physician Practitioner",
  recipient_n     = as.integer(total_number_of_non_physician_practitioners),
  payment_sum     = as.numeric(total_payment_amount_non_physician_practitioner),
  payment_mean    = as.numeric(mean_total_payment_amount_non_physician_practitioner),
  payment_median  = as.numeric(median_total_payment_amount_non_physician_practitioner),
  payments_n      = as.integer(total_payment_count_non_physician_practitioner),
  payments_mean   = as.double(mean_total_payment_count_non_physician_practitioner),
  payments_median = as.double(median_total_payment_count_non_physician_practitioner)
)

x |>
  rowbind() |>
  mtt(recipient_type = factor_(recipient_type)) |>
  roworder(recipient_type, payment_type) |>
  as_tbl()
```

