---
title: "DCAT Metadata Schema"
editor_options: 
   chunk_output_type: console
---

```{r}
#| label: setup-common-01
#| include: false
source("includes/_common.R")

# htmltools::tagList(
#   btn_link(
#     "https://resources.data.gov/resources/dcat-us/", 
#     "DCAT Schema"),
#   btn_link(
#     "https://resources.data.gov/schemas/dcat-us/v1.1/iso8601_guidance/#accrualperiodicity", 
#     "ISO8601"))
```

## DCAT Schemas

## Catalog

```{r}
#| label: schema_catalog
here::here("data/dcat-us_v1.1_schema_catalog.json") |> 
  RcppSimdJson::fload() |> 
  jsonify::to_json() |> 
  jsonify::pretty_json() |> 
  listviewer::jsonedit()
```

## Dataset

```{r}
#| label: schema_dataset
here::here("data/dcat-us_v1.1_schema_dataset.json") |> 
  RcppSimdJson::fload() |> 
  jsonify::to_json() |> 
  jsonify::pretty_json() |> 
  listviewer::jsonedit()
```

## Distribution

```{r}
#| label: schema_distribution
here::here("data/dcat-us_v1.1_schema_distribution.json") |> 
  RcppSimdJson::fload() |> 
  jsonify::to_json() |>
  jsonify::pretty_json() |>
  listviewer::jsonedit()
```


## `dataset` Fields

   * [Data Catalog Vocabulary (DCAT) - Version 3](https://www.w3.org/TR/vocab-dcat/)

### `bureauCode`

Federal agencies, combined agency and bureau code from [OMB Circular A-11, Appendix C](https://obamawhitehouse.archives.gov/sites/default/files/omb/assets/a11_current_year/app_c.pdf). 

> __Format__: `015:11`

```{r}
#| label: bureauCodes
read_csv(
  here("data/omb_bureau_codes.csv"),
  show_col_types  = FALSE,
  col_types       = cols(
    `Agency Name`   = col_character(),
    `Bureau Name`   = col_character(),
    `Agency Code`   = col_character(),
    `Bureau Code`   = col_character(),
    `Treasury Code` = col_character(),
    `CGAC Code`     = col_character()
  )
) |>
  setNames(
    c(
      "agencyName",
      "bureauName",
      "agencyCode",
      "bureauCode",
      "treasuryCode",
      "cgacCode"
    )
  ) |>
  mutate(
    agencyCode   = str_pad(agencyCode, width = 3, pad = "0"),
    bureauCode   = str_pad(bureauCode, width = 2, pad = "0"),
    treasuryCode = str_pad(treasuryCode, width = 2, pad = "0"),
    cgacCode     = str_pad(cgacCode, width = 3, pad = "0")
  )
```

### `programCode`

Federal agencies, list the primary program related to this data asset, from the [Federal Program Inventory](https://resources.data.gov/schemas/dcat-us/v1.1/FederalProgramInventory_FY13_MachineReadable_091613.csv). 

> __Format__: `015:001`

```{r}
#| label: programCodes
read_csv(
  here(
    "data/FederalProgramInventory_FY13_MachineReadable_091613.csv"
  ),
  show_col_types                      = FALSE,
  col_types                           = cols(
    `Agency Name`                       = col_character(),
    `Program Name`                      = col_character(),
    `Additional Information (optional)` = col_character(),
    agencyCode                          = col_character(),
    ProgramCode                         = col_character(),
    ProgramCodePODFormat                = col_character()
  )
) |>
  setNames(
    c(
      "agencyName",
      "programName",
      "additionalInfo",
      "agencyCode",
      "programCode",
      "programCodePODfmt"
    )
  )
```

### `accrualPeriodicity`

```{r}
#| label: accrualPeriodicity
tibble(
  Periodicity = c(
    "R/PT1S",
    "R/PT1H",
    "R/P1D",
    "R/P3.5D",
    "R/P0.33W",
    "R/P0.5W",
    "R/P1W",
    "R/P2W",
    "R/P0.33M",
    "R/P0.5M",
    "R/P1M",
    "R/P2M",
    "R/P3M",
    "R/P4M",
    "R/P6M",
    "R/P1Y",
    "R/P2Y",
    "R/P3Y",
    "R/P4Y",
    "R/P10Y"
  ),
  Description = providertwo:::fmt_periodicity(Periodicity)
) |> 
  gt() |> 
  opt_table_font(font = google_font(name = "JetBrains Mono")) |> 
  tab_options(quarto.disable_processing = TRUE,
              column_labels.font.weight = "bolder") |> 
  opt_stylize(color = "red")
```
