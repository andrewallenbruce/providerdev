---
editor_options: 
   chunk_output_type: console
---

```{r}
#| label: setup-common-01
#| include: false
#| warning: false
source("includes/_common.R")
```

# AHRQ PSI-11 Rates {#care-ahqr}

Agency for Healthcare Research and Quality (AHRQ) Patient Safety Indicator 11 (PSI-11) Measure Rates

## Description

The Agency for Healthcare Research and Quality (AHRQ) Patient Safety Indicator 11 (PSI-11) Measure Rates dataset provides information on provider-level measure rates regarding one preventable complication (postoperative respiratory failure) for Medicare fee-for-service discharges. 

The PSI-11 measure data is solely reported for providers information and quality improvement purposes and are not a part of the Deficit Reduction Act (DRA) Hospital-Acquired Condition (HAC) Payment Provision or HAC Reduction Program.

### Metadata

```{r}
#| label: s7_object
#| echo: false
care_endpoint("ahqr_psi11")
```

### Resources

```{r}
#| label: resources
#| echo: false
care_endpoint("ahqr_psi11") |> list_resources()
```

### Dictionary

```{r}
#| label: data_dict
#| echo: false
ahqr_psi11_dict <- new_tbl(
  field = c(
    "HOSP_ID", 
    "ADM_DISC", 
    "RATE", 
    "INTERVAL_LOWER_LIMIT", 
    "INTERVAL_HIGHER_LIMIT", 
    "START_QUARTER", 
    "START_DATE", 
    "END_QUARTER", 
    "END_DATE"
  ),
  description = c(
    "The provider's CCN ID (6-digit format).", 
    "The provider's number of eligible discharges used for PSI-11 measure calculations.", 
    "The provider's PSI-11 measure smoothed rate result. The rate is reported as per 1,000 discharges.", 
    "The lower limit of the 95% confidence interval surrounding the provider's PSI-11 measure smoothed rate result.", 
    "The upper limit of the 95% confidence interval surrounding the provider's PSI-11 measure smoothed rate result.", 
    "The first quarter of the PSI-11 measure's performance period.", 
    "The first date of the PSI-11 measure's performance period.", 
    "The last quarter of the PSI-11 measure's performance period.", 
    "The last date of the PSI-11 measure's performance period."
  )
)
ahqr_psi11_dict
```


## Response

```{r}
#| label: http_request
#| message: true
resp <- quick("ahqr_psi11", limit = 5000) |> 
  mtt(START_DATE           = clock::date_parse(START_DATE, format = "%m/%d/%Y"),
      END_DATE             = clock::date_parse(END_DATE, format = "%m/%d/%Y"),
      ADM_DISC             = as.double(ADM_DISC),
      RATE                 = as.double(RATE),
      INTERVAL_LOWER_LIMIT = as.double(INTERVAL_LOWER_LIMIT),
      INTERVAL_HIGHER_LIMIT= as.double(INTERVAL_HIGHER_LIMIT))

resp |> dplyr::glimpse()
```

## Overview

```{r}
#| label: datawizard_codebook
#| echo: false
resp |> datawizard::data_codebook()
```

```{r}
#| label: datawizard_distribution
#| echo: false
resp |> datawizard::describe_distribution()
```

```{r}
#| label: point_blank_informant
#| echo: false
#| eval: false
informant <- create_informant(
  tbl = ~ resp, 
  label = "API: Medicare",
  tbl_name = "ahqr_psi11") |> 
  info_tabular(
    Description = "The **Agency for Healthcare Research and Quality (AHRQ) Patient Safety Indicator 11 (PSI-11) Measure Rates** dataset provides information on provider-level measure rates regarding one preventable complication (postoperative respiratory failure) for Medicare fee-for-service discharges. The PSI-11 measure data is solely reported for providers information and quality improvement purposes and are not a part of the Deficit Reduction Act (DRA) Hospital-Acquired Condition (HAC) Payment Provision or HAC Reduction Program.",
    site = "- [data.cms.gov](https://data.cms.gov/quality-of-care/agency-for-healthcare-research-and-quality-ahrq-patient-safety-indicator-11-psi-11-measure-rates)",
    references = "- [AHRQ PSI-11 Measure Rate Methodology](https://data.cms.gov/sites/default/files/2020-09/Agency%20for%20Healthcare%20Research%20and%20Quality%20%28AHRQ%29%20Patient%20Safety%20Indicator%2011%20%28PSI-11%29%20Measure%20Rates%20Methodology_0.pdf)",
    ) |> 
  info_columns_from_tbl(tbl = ahqr_psi11_info)


informant <- informant |> 
  info_snippet(snippet_name = "stats_RATE", fn = snip_stats(column = "RATE")) |> 
  info_columns(columns = RATE, `Stats` = "{stats_RATE}.") |> 
  info_snippet(snippet_name = "stats_ADM_DISC", fn = snip_stats(column = "ADM_DISC", type = "bowley")) |> 
  info_columns(columns = ADM_DISC, `Stats` = "{stats_ADM_DISC}.") |> 
  incorporate()

get_informant_report(
  informant,
  title = "**AHRQ PSI-11 Measure Rates**",
  size = "small"
)

ahqr_psi_scan <- pointblank::scan_data(resp, navbar = FALSE)
pointblank::export_report(ahqr_psi_scan, filename = "ahqr_psi_scan.html")
```
